{
    "apiVersion": "v1",
    "items": [
        {
            "apiVersion": "v1",
            "data": {
                "ca.crt": "-----BEGIN CERTIFICATE-----\nMIIDBTCCAe2gAwIBAgIIdVZ4OXlm3howDQYJKoZIhvcNAQELBQAwFTETMBEGA1UE\nAxMKa3ViZXJuZXRlczAeFw0yNTEyMTgxODIxNTVaFw0zNTEyMTYxODI2NTVaMBUx\nEzARBgNVBAMTCmt1YmVybmV0ZXMwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEK\nAoIBAQDRmY/1mdgGLX5JJz4mQmbSxg5C9OxhaR4Z2iQnuZjfqv/Ad186OXBadxRw\neVgeye4P1iWvmjcqY9q3pbdjN2WdE4x1p/tXFN6A4onbZypXN8pkXSAqyf0+D/QX\n5UY7mRtMHjgrOqAQ/0Lr79r6lX8bKvwHq8oiVjpwcHHb08ouq99B7TCJZ5d6EYeQ\n3ZGdbt2Vo/JM2xGfoXm1NBP26L3EnuXCDHlrQp0ERAQM68KRiyCNNDynwjz/DLtX\nofZrG+p2pWYc0C4NvXH3B8/1PjiQ6kcc6noKoBFerfobuVLJmkW+8qhdInmkvRt6\nfVDpzklrxUNMp/rIMbdxxTQ5S4g9AgMBAAGjWTBXMA4GA1UdDwEB/wQEAwICpDAP\nBgNVHRMBAf8EBTADAQH/MB0GA1UdDgQWBBQBfYhN6j9YZrHNfGRZH+zhNzZh/TAV\nBgNVHREEDjAMggprdWJlcm5ldGVzMA0GCSqGSIb3DQEBCwUAA4IBAQBgnq6yWBQd\nC6Z/LReT/E39sJG03rzXz5NRoQBZMONAfvL+jlzRkqK+T70/jGZlu9mNNZFa7fck\npjoO6QXqBHli60feBMJeUTrK5az1V8rPgKpEt34Esy6NVc8S52RzSy78HtQejh2l\nXPNLA/BuGMOP1kuaizM7axYW4luqyankgHNXiKxxoK2qsc+mtELapmtSu1a3oaqx\nV6ZO/4/EoV25KORXWMQ4IZ7sK+dPbr6Mh/GejaZG2N2lTFAWA1a9C2ZootKg8VDO\nKFvVePd227BqD5153nQ7r8u3BckJj+9tfUn/JCTlDnDdx/YFqv64vZU7FWHIW7CU\nwGjni5x+bo3m\n-----END CERTIFICATE-----\n"
            },
            "kind": "ConfigMap",
            "metadata": {
                "annotations": {
                    "kubernetes.io/description": "Contains a CA bundle that can be used to verify the kube-apiserver when using internal endpoints such as the internal service IP or kubernetes.default.svc. No other usage is guaranteed across distributions of Kubernetes clusters."
                },
                "creationTimestamp": "2026-01-13T16:22:21Z",
                "name": "kube-root-ca.crt",
                "namespace": "zabbix",
                "resourceVersion": "4353528",
                "uid": "881e7c7f-4c45-421c-bf35-5b373d309ce6"
            }
        },
        {
            "apiVersion": "v1",
            "data": {
                "github_connector.sh": "#!/bin/bash\n# [DEPRECATED] Este script ya no es necesario con el template nativo \"Template GitHub Repository Metrics\" (HTTP_AGENT).\n# La configuración ahora se realiza via Macros en la interfaz web de Zabbix.\n#\n# Script para conectar Zabbix con GitHub (Soporta Token)\n# Uso: github_connector.sh \u003cOWNER\u003e \u003cREPO\u003e \u003cTYPE\u003e \u003cTOKEN\u003e \u003cAPI_URL\u003e\n\nOWNER=\"${1:-Ka0s-Klaus}\"\nREPO=\"${2:-ka0s}\"\nTYPE=\"${3:-metrics}\"\nTOKEN=\"$4\"\nAPI_URL=\"${5:-https://api.github.com}\"\n\nFULL_REPO=\"$OWNER/$REPO\"\nJQ_BIN=\"/tmp/jq\"\n\n# Auto-descarga de jq\nif [ ! -f \"$JQ_BIN\" ]; then\n    wget -q --timeout=10 -O \"$JQ_BIN\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\n    chmod +x \"$JQ_BIN\"\nfi\n\n# Función wrapper para wget con autenticación opcional\nfetch_url() {\n    local url=\"$1\"\n    if [ -n \"$TOKEN\" ] \u0026\u0026 [ \"$TOKEN\" != \"\" ]; then\n        wget -q --no-check-certificate --timeout=10 --header=\"Authorization: Bearer $TOKEN\" -O - \"$url\"\n    else\n        wget -q --no-check-certificate --timeout=10 -O - \"$url\"\n    fi\n}\n\nif [ \"$TYPE\" = \"metrics\" ]; then\n    # 1. Info General\n    REPO_JSON=$(fetch_url \"$API_URL/repos/$FULL_REPO\")\n    \n    # 2. Pull Requests (Search API)\n    PR_JSON=$(fetch_url \"$API_URL/search/issues?q=repo:$FULL_REPO+type:pr+state:open\")\n    \n    if [ -x \"$JQ_BIN\" ] \u0026\u0026 [ -n \"$REPO_JSON\" ]; then\n        echo \"$REPO_JSON\" | \"$JQ_BIN\" --argjson prs \"$PR_JSON\" '{\n            stars: .stargazers_count,\n            forks: .forks_count,\n            open_issues: .open_issues_count,\n            watchers: .subscribers_count,\n            size_kb: .size,\n            created_at: .created_at,\n            updated_at: .updated_at,\n            pushed_at: .pushed_at,\n            language: .language,\n            open_prs: $prs.total_count\n        }'\n    else\n        echo \"Error: jq required or no data\"\n    fi\n    \nelif [ \"$TYPE\" = \"info\" ]; then\n    # Legacy info\n    JSON=$(fetch_url \"$API_URL/repos/$FULL_REPO\")\n    STARS=$(echo \"$JSON\" | grep -o '\"stargazers_count\": [0-9]*' | head -1 | awk '{print $2}')\n    echo \"Stars: $STARS\"\n    \nelse\n    # Actions\n    JSON=$(fetch_url \"$API_URL/repos/$FULL_REPO/actions/runs?per_page=10\")\n    \n    if [ -x \"$JQ_BIN\" ] \u0026\u0026 [ -n \"$JSON\" ]; then\n         echo \"$JSON\" | \"$JQ_BIN\" -r '.workflow_runs[] | \"Workflow: \\(.name) (#\\(.run_number)) | Status: \\(.conclusion) | Branch: \\(.head_branch) | Author: \\(.actor.login) | Event: \\(.event)\"'\n    else\n         echo \"Error: jq required or no data\"\n    fi\nfi\n",
                "k8s_cluster_stats.sh": "#!/bin/bash\nAPI_URL=\"https://kubernetes.default.svc\"\nTOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\nJQ_BIN=\"/tmp/jq\"\nif command -v jq \u003e/dev/null 2\u003e\u00261; then\n    JQ_BIN=$(command -v jq)\nelif [ ! -f \"$JQ_BIN\" ]; then\n    wget -q --no-check-certificate --timeout=10 -O \"$JQ_BIN\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\n    chmod +x \"$JQ_BIN\"\nfi\n\nif [ ! -x \"$JQ_BIN\" ]; then\n    # Return valid JSON with 0s if critical tool is missing\n    echo '{\"nodes\":0,\"allocatable_cpu\":0,\"allocatable_mem\":0,\"usage_cpu\":0,\"usage_mem\":0,\"requests_cpu\":0,\"requests_mem\":0,\"pods\":0,\"pods_running\":0,\"pods_pending\":0,\"pods_failed\":0,\"pods_succeeded\":0,\"pods_restarts\":0,\"cpu_avg\":0,\"mem_avg\":0,\"deployments_desired\":0,\"deployments_available\":0,\"services_total\":0,\"services_unhealthy\":0}'\n    exit 0\nfi\n\n# --- 1. Fetch Nodes for Allocatable Resources \u0026 Conditions ---\nNODES_JSON=$(wget -q --no-check-certificate --timeout=10 --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/nodes\")\n\nif [ -n \"$NODES_JSON\" ]; then\n    NODE_COUNT=$(echo \"$NODES_JSON\" | \"$JQ_BIN\" '.items | length')\n    ALLOC_CPU=$(echo \"$NODES_JSON\" | \"$JQ_BIN\" '[.items[].status.allocatable.cpu | if test(\"m$\") then sub(\"m\";\"\")|tonumber else tonumber*1000 end] | add')\n    ALLOC_MEM=$(echo \"$NODES_JSON\" | \"$JQ_BIN\" '[.items[].status.allocatable.memory | if test(\"Ki$\") then sub(\"Ki\";\"\")|tonumber*1024 else if test(\"Mi$\") then sub(\"Mi\";\"\")|tonumber*1048576 else if test(\"Gi$\") then sub(\"Gi\";\"\")|tonumber*1073741824 else tonumber end end end] | add')\nelse\n    NODE_COUNT=0; ALLOC_CPU=0; ALLOC_MEM=0\nfi\n\n# --- 2. Fetch Pods for Status Counts \u0026 Requests/Limits ---\nPODS_JSON=$(wget -q --no-check-certificate --timeout=10 --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/pods\")\n\nif [ -n \"$PODS_JSON\" ]; then\n    POD_COUNT=$(echo \"$PODS_JSON\" | \"$JQ_BIN\" '.items | length')\n    PODS_RUNNING=$(echo \"$PODS_JSON\" | \"$JQ_BIN\" '[.items[] | select(.status.phase==\"Running\")] | length')\n    PODS_PENDING=$(echo \"$PODS_JSON\" | \"$JQ_BIN\" '[.items[] | select(.status.phase==\"Pending\")] | length')\n    PODS_FAILED=$(echo \"$PODS_JSON\" | \"$JQ_BIN\" '[.items[] | select(.status.phase==\"Failed\")] | length')\n    PODS_SUCCEEDED=$(echo \"$PODS_JSON\" | \"$JQ_BIN\" '[.items[] | select(.status.phase==\"Succeeded\")] | length')\n    TOTAL_RESTARTS=$(echo \"$PODS_JSON\" | \"$JQ_BIN\" '[.items[].status.containerStatuses[]?.restartCount // 0] | add')\n    \n    REQ_CPU=$(echo \"$PODS_JSON\" | \"$JQ_BIN\" '[.items[].spec.containers[].resources.requests.cpu // \"0\"] | map(if test(\"m$\") then sub(\"m\";\"\")|tonumber else if test(\"^[0-9]+$\") then tonumber*1000 else 0 end end) | add')\n    REQ_MEM=$(echo \"$PODS_JSON\" | \"$JQ_BIN\" '[.items[].spec.containers[].resources.requests.memory // \"0\"] | map(if test(\"Ki$\") then sub(\"Ki\";\"\")|tonumber*1024 else if test(\"Mi$\") then sub(\"Mi\";\"\")|tonumber*1048576 else if test(\"Gi$\") then sub(\"Gi\";\"\")|tonumber*1073741824 else if test(\"^[0-9]+$\") then tonumber else 0 end end end end) | add')\nelse\n    POD_COUNT=0; PODS_RUNNING=0; PODS_PENDING=0; PODS_FAILED=0; PODS_SUCCEEDED=0; TOTAL_RESTARTS=0; REQ_CPU=0; REQ_MEM=0\nfi\n\n# --- 3. Deployments Stats ---\nDEPLOYS_JSON=$(wget -q --no-check-certificate --timeout=10 --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/apis/apps/v1/deployments\")\n\nif [ -n \"$DEPLOYS_JSON\" ]; then\n    DEP_DESIRED=$(echo \"$DEPLOYS_JSON\" | \"$JQ_BIN\" '[.items[].spec.replicas // 0] | add')\n    DEP_AVAILABLE=$(echo \"$DEPLOYS_JSON\" | \"$JQ_BIN\" '[.items[].status.availableReplicas // 0] | add')\nelse\n    DEP_DESIRED=0; DEP_AVAILABLE=0\nfi\n\n# --- 4. Services Health ---\nENDPOINTS_JSON=$(wget -q --no-check-certificate --timeout=10 --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/endpoints\")\n\nif [ -n \"$ENDPOINTS_JSON\" ]; then\n    SVC_TOTAL=$(echo \"$ENDPOINTS_JSON\" | \"$JQ_BIN\" '.items | length')\n    SVC_UNHEALTHY=$(echo \"$ENDPOINTS_JSON\" | \"$JQ_BIN\" '[.items[] | select(.subsets == null or (.subsets | length == 0))] | length')\nelse\n    SVC_TOTAL=0; SVC_UNHEALTHY=0\nfi\n\n# --- 5. Usage Metrics ---\nMETRICS=$(wget -q --no-check-certificate --timeout=10 --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/apis/metrics.k8s.io/v1beta1/nodes\")\n\nif [ -n \"$METRICS\" ]; then\n    METRICS_COUNT=$(echo \"$METRICS\" | \"$JQ_BIN\" '.items | length')\nelse\n    METRICS_COUNT=0\nfi\n\nif [ \"$METRICS_COUNT\" -gt 0 ]; then\n   USAGE_CPU=$(echo \"$METRICS\" | \"$JQ_BIN\" '[.items[].usage.cpu | sub(\"n\";\"\") | tonumber] | add')\n   USAGE_CPU=$((USAGE_CPU / 1000000)) # nano to milli\n   \n   USAGE_MEM=$(echo \"$METRICS\" | \"$JQ_BIN\" '[.items[].usage.memory | sub(\"Ki\";\"\") | tonumber] | add')\n   USAGE_MEM=$((USAGE_MEM * 1024)) # Ki to Bytes\n   \n   CPU_AVG=$((USAGE_CPU / METRICS_COUNT))\n   MEM_AVG=$((USAGE_MEM / METRICS_COUNT))\nelse\n   USAGE_CPU=0; USAGE_MEM=0; CPU_AVG=0; MEM_AVG=0\nfi\n\n# Construct JSON Output\necho \"{\n    \\\"nodes\\\": ${NODE_COUNT:-0},\n    \\\"allocatable_cpu\\\": ${ALLOC_CPU:-0},\n    \\\"allocatable_mem\\\": ${ALLOC_MEM:-0},\n    \\\"usage_cpu\\\": ${USAGE_CPU:-0},\n    \\\"usage_mem\\\": ${USAGE_MEM:-0},\n    \\\"requests_cpu\\\": ${REQ_CPU:-0},\n    \\\"requests_mem\\\": ${REQ_MEM:-0},\n    \\\"pods\\\": ${POD_COUNT:-0},\n    \\\"pods_running\\\": ${PODS_RUNNING:-0},\n    \\\"pods_pending\\\": ${PODS_PENDING:-0},\n    \\\"pods_failed\\\": ${PODS_FAILED:-0},\n    \\\"pods_succeeded\\\": ${PODS_SUCCEEDED:-0},\n    \\\"pods_restarts\\\": ${TOTAL_RESTARTS:-0},\n    \\\"cpu_avg\\\": ${CPU_AVG:-0},\n    \\\"mem_avg\\\": ${MEM_AVG:-0},\n    \\\"deployments_desired\\\": ${DEP_DESIRED:-0},\n    \\\"deployments_available\\\": ${DEP_AVAILABLE:-0},\n    \\\"services_total\\\": ${SVC_TOTAL:-0},\n    \\\"services_unhealthy\\\": ${SVC_UNHEALTHY:-0}\n}\"\n",
                "k8s_deployment_discovery.sh": "#!/bin/bash\nAPI_URL=\"https://kubernetes.default.svc\"\nTOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\nJQ_BIN=\"/tmp/jq\"\nif [ ! -f \"$JQ_BIN\" ]; then\n    wget -q --timeout=10 -O \"$JQ_BIN\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\n    chmod +x \"$JQ_BIN\"\nfi\nJSON=$(wget -q --no-check-certificate --timeout=10 --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/apis/apps/v1/deployments\")\n\nif [ -n \"$JSON\" ] \u0026\u0026 [ -x \"$JQ_BIN\" ]; then\n    echo \"$JSON\" | \"$JQ_BIN\" -c '{data: [.items[] | {\"{#NAME}\": .metadata.name, \"{#NAMESPACE}\": .metadata.namespace}]}'\nelse\n    echo '{\"data\":[]}'\nfi\n",
                "k8s_deployment_metrics.sh": "#!/bin/bash\nNAMESPACE=\"$1\"\nNAME=\"$2\"\nMETRIC=\"$3\"\nAPI_URL=\"https://kubernetes.default.svc\"\nTOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\nJQ_BIN=\"/tmp/jq\"\nif [ ! -f \"$JQ_BIN\" ]; then\n    wget -q --timeout=10 -O \"$JQ_BIN\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\n    chmod +x \"$JQ_BIN\"\nfi\nJSON=$(wget -q --no-check-certificate --timeout=10 --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/apis/apps/v1/namespaces/$NAMESPACE/deployments/$NAME\")\n\nif [ -z \"$JSON\" ] || [ ! -x \"$JQ_BIN\" ]; then echo \"0\"; exit 0; fi\n\nif [ \"$METRIC\" = \"replicas\" ]; then\n    echo \"$JSON\" | \"$JQ_BIN\" '.spec.replicas // 0'\nelif [ \"$METRIC\" = \"available_replicas\" ]; then\n    echo \"$JSON\" | \"$JQ_BIN\" '.status.availableReplicas // 0'\nelif [ \"$METRIC\" = \"unavailable_replicas\" ]; then\n    echo \"$JSON\" | \"$JQ_BIN\" '.status.unavailableReplicas // 0'\nelse\n    echo \"0\"\nfi\n",
                "k8s_discovery.sh": "#!/bin/bash\nAPI_URL=\"https://kubernetes.default.svc\"\nTOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\nJQ_BIN=\"/tmp/jq\"\n\nif command -v jq \u003e/dev/null 2\u003e\u00261; then\n    JQ_BIN=$(command -v jq)\nelif [ ! -f \"$JQ_BIN\" ]; then\n    wget -q --no-check-certificate --timeout=10 -O \"$JQ_BIN\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\n    chmod +x \"$JQ_BIN\"\nfi\n\n# Discovery\nJSON=$(wget -q --no-check-certificate --timeout=10 --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/services\")\n\nif [ -n \"$JSON\" ] \u0026\u0026 [ -x \"$JQ_BIN\" ]; then\n    echo \"$JSON\" | \"$JQ_BIN\" -c '{data: [.items[] | {\"{#SERVICE_NAME}\": .metadata.name, \"{#SERVICE_NAMESPACE}\": .metadata.namespace, \"{#SERVICE_TYPE}\": .spec.type}]}'\nelse\n    echo '{\"data\":[]}'\nfi\n",
                "k8s_endpoints.sh": "#!/bin/bash\nNAMESPACE=\"$1\"\nNAME=\"$2\"\nAPI_URL=\"https://kubernetes.default.svc\"\nTOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\nJQ_BIN=\"/tmp/jq\"\n\nif command -v jq \u003e/dev/null 2\u003e\u00261; then\n    JQ_BIN=$(command -v jq)\nelif [ ! -f \"$JQ_BIN\" ]; then\n    wget -q --no-check-certificate --timeout=10 -O \"$JQ_BIN\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\n    chmod +x \"$JQ_BIN\"\nfi\n\nJSON=$(wget -q --no-check-certificate --timeout=10 --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/namespaces/$NAMESPACE/endpoints/$NAME\")\n\n# Count subsets[].addresses[].ip\nif [ -n \"$JSON\" ] \u0026\u0026 [ -x \"$JQ_BIN\" ]; then\n    COUNT=$(echo \"$JSON\" | \"$JQ_BIN\" '[.subsets[]?.addresses[]?] | length')\nfi\n\nif [ -z \"$COUNT\" ]; then echo 0; else echo \"$COUNT\"; fi\n",
                "k8s_namespace_discovery.sh": "#!/bin/bash\nAPI_URL=\"https://kubernetes.default.svc\"\nTOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\nJQ_BIN=\"/tmp/jq\"\nif command -v jq \u003e/dev/null 2\u003e\u00261; then\n    JQ_BIN=$(command -v jq)\nelif [ ! -f \"$JQ_BIN\" ]; then\n    wget -q --no-check-certificate --timeout=10 -O \"$JQ_BIN\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\n    chmod +x \"$JQ_BIN\"\nfi\nJSON=$(wget -q --no-check-certificate --timeout=10 --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/namespaces\")\n\nif [ -n \"$JSON\" ] \u0026\u0026 [ -x \"$JQ_BIN\" ]; then\n    echo \"$JSON\" | \"$JQ_BIN\" -c '{data: [.items[] | {\"{#NAMESPACE}\": .metadata.name}]}'\nelse\n    echo '{\"data\":[]}'\nfi\n",
                "k8s_namespace_metrics.sh": "#!/bin/bash\nNAMESPACE=\"$1\"\nMETRIC=\"$2\"\nAPI_URL=\"https://kubernetes.default.svc\"\nTOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\nJQ_BIN=\"/tmp/jq\"\nif command -v jq \u003e/dev/null 2\u003e\u00261; then\n    JQ_BIN=$(command -v jq)\nelif [ ! -f \"$JQ_BIN\" ]; then\n    wget -q --no-check-certificate --timeout=10 -O \"$JQ_BIN\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\n    chmod +x \"$JQ_BIN\"\nfi\n\nif [ ! -x \"$JQ_BIN\" ]; then echo \"0\"; exit 0; fi\n\nif [ \"$METRIC\" = \"restarts\" ]; then\n    JSON=$(wget -q --no-check-certificate --timeout=10 --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/namespaces/$NAMESPACE/pods\")\n    [ -z \"$JSON\" ] \u0026\u0026 echo \"0\" \u0026\u0026 exit 0\n    RESTARTS=$(echo \"$JSON\" | \"$JQ_BIN\" '[.items[].status.containerStatuses[]?.restartCount // 0] | add')\n    echo \"${RESTARTS:-0}\"\nelse\n    echo \"0\"\nfi\n",
                "k8s_node_discovery.sh": "#!/bin/bash\nAPI_URL=\"https://kubernetes.default.svc\"\nTOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\nJQ_BIN=\"/tmp/jq\"\nif command -v jq \u003e/dev/null 2\u003e\u00261; then\n    JQ_BIN=$(command -v jq)\nelif [ ! -f \"$JQ_BIN\" ]; then\n    wget -q --no-check-certificate --timeout=10 -O \"$JQ_BIN\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\n    chmod +x \"$JQ_BIN\"\nfi\nJSON=$(wget -q --no-check-certificate --timeout=10 --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/nodes\")\n\nif [ -n \"$JSON\" ] \u0026\u0026 [ -x \"$JQ_BIN\" ]; then\n    echo \"$JSON\" | \"$JQ_BIN\" -c '{data: [.items[] | {\"{#NODE_NAME}\": .metadata.name}]}'\nelse\n    echo '{\"data\":[]}'\nfi\n",
                "k8s_node_metrics.sh": "#!/bin/bash\nNODE_NAME=\"$1\"\nMETRIC=\"$2\"\nAPI_URL=\"https://kubernetes.default.svc\"\nTOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\nJQ_BIN=\"/tmp/jq\"\nif command -v jq \u003e/dev/null 2\u003e\u00261; then\n    JQ_BIN=$(command -v jq)\nelif [ ! -f \"$JQ_BIN\" ]; then\n    wget -q --no-check-certificate --timeout=10 -O \"$JQ_BIN\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\n    chmod +x \"$JQ_BIN\"\nfi\n\nif [ ! -x \"$JQ_BIN\" ]; then echo \"0\"; exit 0; fi\n\n# Standard metrics from metrics API\nif [ \"$METRIC\" = \"cpu\" ] || [ \"$METRIC\" = \"memory\" ]; then\n    JSON=$(wget -q --no-check-certificate --timeout=10 --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/apis/metrics.k8s.io/v1beta1/nodes/$NODE_NAME\")\n    [ -z \"$JSON\" ] \u0026\u0026 echo \"0\" \u0026\u0026 exit 0\n    \n    if [ \"$METRIC\" = \"cpu\" ]; then\n        V=$(echo \"$JSON\" | \"$JQ_BIN\" -r '.usage.cpu // empty')\n        if [ -z \"$V\" ]; then echo \"0\"; exit 0; fi\n        if [[ \"$V\" == *n ]]; then NUM=${V%n}; MILLI=$((NUM / 1000000));\n        elif [[ \"$V\" == *m ]]; then MILLI=${V%m};\n        elif [[ \"$V\" == *u ]]; then NUM=${V%u}; MILLI=$((NUM / 1000));\n        else MILLI=$((V * 1000)); fi\n        echo \"$MILLI\"\n    elif [ \"$METRIC\" = \"memory\" ]; then\n        V=$(echo \"$JSON\" | \"$JQ_BIN\" -r '.usage.memory // empty')\n        if [ -z \"$V\" ]; then echo \"0\"; exit 0; fi\n        if [[ \"$V\" == *Ki ]]; then NUM=${V%Ki}; BYTES=$((NUM * 1024));\n        elif [[ \"$V\" == *Mi ]]; then NUM=${V%Mi}; BYTES=$((NUM * 1024 * 1024));\n        elif [[ \"$V\" == *Gi ]]; then NUM=${V%Gi}; BYTES=$((NUM * 1024 * 1024 * 1024));\n        else BYTES=$V; fi\n        echo \"$BYTES\"\n    fi\n# Node Conditions from Core API\nelse\n    JSON=$(wget -q --no-check-certificate --timeout=10 --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/nodes/$NODE_NAME\")\n    [ -z \"$JSON\" ] \u0026\u0026 echo \"0\" \u0026\u0026 exit 0\n    \n    if [ \"$METRIC\" = \"disk_pressure\" ]; then\n        STATUS=$(echo \"$JSON\" | \"$JQ_BIN\" -r '.status.conditions[] | select(.type==\"DiskPressure\") | .status')\n        if [ \"$STATUS\" = \"True\" ]; then echo 1; else echo 0; fi\n    elif [ \"$METRIC\" = \"memory_pressure\" ]; then\n        STATUS=$(echo \"$JSON\" | \"$JQ_BIN\" -r '.status.conditions[] | select(.type==\"MemoryPressure\") | .status')\n        if [ \"$STATUS\" = \"True\" ]; then echo 1; else echo 0; fi\n    elif [ \"$METRIC\" = \"ready\" ]; then\n        STATUS=$(echo \"$JSON\" | \"$JQ_BIN\" -r '.status.conditions[] | select(.type==\"Ready\") | .status')\n        if [ \"$STATUS\" = \"True\" ]; then echo 1; else echo 0; fi\n    elif [ \"$METRIC\" = \"network_errors\" ]; then\n        # Fetch from Kubelet Summary API via Proxy\n        JSON=$(wget -q --no-check-certificate --timeout=10 --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/nodes/$NODE_NAME/proxy/stats/summary\")\n        [ -z \"$JSON\" ] \u0026\u0026 echo \"0\" \u0026\u0026 exit 0\n        # Sum rxErrors and txErrors from all interfaces\n        RX=$(echo \"$JSON\" | \"$JQ_BIN\" '[.node.network.interfaces[]?.rxErrors // 0] | add')\n        TX=$(echo \"$JSON\" | \"$JQ_BIN\" '[.node.network.interfaces[]?.txErrors // 0] | add')\n        echo $((RX + TX))\n    elif [ \"$METRIC\" = \"disk_usage\" ]; then\n        JSON=$(wget -q --no-check-certificate --timeout=10 --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/nodes/$NODE_NAME/proxy/stats/summary\")\n        [ -z \"$JSON\" ] \u0026\u0026 echo \"0\" || echo \"$JSON\" | \"$JQ_BIN\" '.node.fs.usedBytes // 0'\n    elif [ \"$METRIC\" = \"disk_capacity\" ]; then\n        JSON=$(wget -q --no-check-certificate --timeout=10 --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/nodes/$NODE_NAME/proxy/stats/summary\")\n        [ -z \"$JSON\" ] \u0026\u0026 echo \"0\" || echo \"$JSON\" | \"$JQ_BIN\" '.node.fs.capacityBytes // 0'\n    else\n        echo \"0\"\n    fi\nfi\n",
                "k8s_pod_discovery.sh": "#!/bin/bash\nAPI_URL=\"https://kubernetes.default.svc\"\nTOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\nJQ_BIN=\"/tmp/jq\"\nif command -v jq \u003e/dev/null 2\u003e\u00261; then\n    JQ_BIN=$(command -v jq)\nelif [ ! -f \"$JQ_BIN\" ]; then\n    wget -q --no-check-certificate --timeout=10 -O \"$JQ_BIN\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\n    chmod +x \"$JQ_BIN\"\nfi\nJSON=$(wget -q --no-check-certificate --timeout=10 --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/pods\")\n\nif [ -n \"$JSON\" ] \u0026\u0026 [ -x \"$JQ_BIN\" ]; then\n    echo \"$JSON\" | \"$JQ_BIN\" -c '{data: [.items[] | {\"{#POD_NAME}\": .metadata.name, \"{#POD_NAMESPACE}\": .metadata.namespace, \"{#POD_IP}\": .status.podIP}]}'\nelse\n    echo '{\"data\":[]}'\nfi\n",
                "k8s_pod_metrics.sh": "#!/bin/bash\nNAMESPACE=\"$1\"\nNAME=\"$2\"\nMETRIC=\"$3\"\nAPI_URL=\"https://kubernetes.default.svc\"\nTOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\nJQ_BIN=\"/tmp/jq\"\nif command -v jq \u003e/dev/null 2\u003e\u00261; then\n    JQ_BIN=$(command -v jq)\nelif [ ! -f \"$JQ_BIN\" ]; then\n    wget -q --no-check-certificate --timeout=10 -O \"$JQ_BIN\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\n    chmod +x \"$JQ_BIN\"\nfi\n\nif [ ! -x \"$JQ_BIN\" ]; then echo \"0\"; exit 0; fi\n\nif [ \"$METRIC\" = \"cpu\" ] || [ \"$METRIC\" = \"memory\" ]; then\n    # Fetch from Metrics API\n    JSON=$(wget -q --no-check-certificate --timeout=10 --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/apis/metrics.k8s.io/v1beta1/namespaces/$NAMESPACE/pods/$NAME\")\n    [ -z \"$JSON\" ] \u0026\u0026 echo \"0\" \u0026\u0026 exit 0\n\n    if [ \"$METRIC\" = \"cpu\" ]; then\n        VALS=$(echo \"$JSON\" | \"$JQ_BIN\" -r '.containers[].usage.cpu // empty')\n        if [ -z \"$VALS\" ]; then echo \"0\"; exit 0; fi\n        TOTAL=0\n        for V in $VALS; do\n            if [[ \"$V\" == *n ]]; then NUM=${V%n}; MILLI=$((NUM / 1000000));\n            elif [[ \"$V\" == *m ]]; then MILLI=${V%m};\n            elif [[ \"$V\" == *u ]]; then NUM=${V%u}; MILLI=$((NUM / 1000));\n            else MILLI=$((V * 1000)); fi\n            TOTAL=$((TOTAL + MILLI))\n        done\n        echo \"$TOTAL\"\n    elif [ \"$METRIC\" = \"memory\" ]; then\n        VALS=$(echo \"$JSON\" | \"$JQ_BIN\" -r '.containers[].usage.memory // empty')\n        if [ -z \"$VALS\" ]; then echo \"0\"; exit 0; fi\n        TOTAL=0\n        for V in $VALS; do\n            if [[ \"$V\" == *Ki ]]; then NUM=${V%Ki}; BYTES=$((NUM * 1024));\n            elif [[ \"$V\" == *Mi ]]; then NUM=${V%Mi}; BYTES=$((NUM * 1024 * 1024));\n            elif [[ \"$V\" == *Gi ]]; then NUM=${V%Gi}; BYTES=$((NUM * 1024 * 1024 * 1024));\n            else BYTES=$V; fi\n            TOTAL=$((TOTAL + BYTES))\n        done\n        echo \"$TOTAL\"\n    fi\nelif [ \"$METRIC\" = \"restarts\" ]; then\n    # Fetch from Core API\n    JSON=$(wget -q --no-check-certificate --timeout=10 --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/namespaces/$NAMESPACE/pods/$NAME\")\n    [ -z \"$JSON\" ] \u0026\u0026 echo \"0\" \u0026\u0026 exit 0\n    RESTARTS=$(echo \"$JSON\" | \"$JQ_BIN\" '[.status.containerStatuses[]?.restartCount] | add')\n    echo \"${RESTARTS:-0}\"\nelif [ \"$METRIC\" = \"oom_killed\" ]; then\n    # Check if any container was terminated with reason OOMKilled\n    JSON=$(wget -q --no-check-certificate --timeout=10 --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/namespaces/$NAMESPACE/pods/$NAME\")\n    [ -z \"$JSON\" ] \u0026\u0026 echo \"0\" \u0026\u0026 exit 0\n    OOM=$(echo \"$JSON\" | \"$JQ_BIN\" '[.status.containerStatuses[]?.lastState.terminated.reason == \"OOMKilled\"] | any')\n    if [ \"$OOM\" = \"true\" ]; then echo 1; else echo 0; fi\nelif [ \"$METRIC\" = \"phase\" ]; then\n     JSON=$(wget -q --no-check-certificate --timeout=10 --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/namespaces/$NAMESPACE/pods/$NAME\")\n     [ -z \"$JSON\" ] \u0026\u0026 echo \"Unknown\" \u0026\u0026 exit 0\n     echo \"$JSON\" | \"$JQ_BIN\" -r '.status.phase'\nelif [ \"$METRIC\" = \"limits_cpu\" ]; then\n     JSON=$(wget -q --no-check-certificate --timeout=10 --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/namespaces/$NAMESPACE/pods/$NAME\")\n     [ -z \"$JSON\" ] \u0026\u0026 echo \"0\" \u0026\u0026 exit 0\n     VALS=$(echo \"$JSON\" | \"$JQ_BIN\" -r '.spec.containers[].resources.limits.cpu // empty')\n     if [ -z \"$VALS\" ]; then echo \"0\"; exit 0; fi\n     TOTAL=0\n     for V in $VALS; do\n         if [[ \"$V\" == *m ]]; then MILLI=${V%m};\n         elif [[ \"$V\" == *[0-9] ]]; then MILLI=$((V * 1000));\n         else MILLI=0; fi\n         TOTAL=$((TOTAL + MILLI))\n     done\n     echo \"$TOTAL\"\nelif [ \"$METRIC\" = \"limits_memory\" ]; then\n     JSON=$(wget -q --no-check-certificate --timeout=10 --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/namespaces/$NAMESPACE/pods/$NAME\")\n     [ -z \"$JSON\" ] \u0026\u0026 echo \"0\" \u0026\u0026 exit 0\n     VALS=$(echo \"$JSON\" | \"$JQ_BIN\" -r '.spec.containers[].resources.limits.memory // empty')\n     if [ -z \"$VALS\" ]; then echo \"0\"; exit 0; fi\n     TOTAL=0\n     for V in $VALS; do\n         if [[ \"$V\" == *Ki ]]; then NUM=${V%Ki}; BYTES=$((NUM * 1024));\n         elif [[ \"$V\" == *Mi ]]; then NUM=${V%Mi}; BYTES=$((NUM * 1024 * 1024));\n         elif [[ \"$V\" == *Gi ]]; then NUM=${V%Gi}; BYTES=$((NUM * 1024 * 1024 * 1024));\n         elif [[ \"$V\" == *[0-9] ]]; then BYTES=$V;\n         else BYTES=0; fi\n         TOTAL=$((TOTAL + BYTES))\n     done\n     echo \"$TOTAL\"\nelse\n    echo \"0\"\nfi\n"
            },
            "kind": "ConfigMap",
            "metadata": {
                "annotations": {
                    "kubectl.kubernetes.io/last-applied-configuration": "{\"apiVersion\":\"v1\",\"data\":{\"github_connector.sh\":\"#!/bin/bash\\n# [DEPRECATED] Este script ya no es necesario con el template nativo \\\"Template GitHub Repository Metrics\\\" (HTTP_AGENT).\\n# La configuración ahora se realiza via Macros en la interfaz web de Zabbix.\\n#\\n# Script para conectar Zabbix con GitHub (Soporta Token)\\n# Uso: github_connector.sh \\u003cOWNER\\u003e \\u003cREPO\\u003e \\u003cTYPE\\u003e \\u003cTOKEN\\u003e \\u003cAPI_URL\\u003e\\n\\nOWNER=\\\"${1:-Ka0s-Klaus}\\\"\\nREPO=\\\"${2:-ka0s}\\\"\\nTYPE=\\\"${3:-metrics}\\\"\\nTOKEN=\\\"$4\\\"\\nAPI_URL=\\\"${5:-https://api.github.com}\\\"\\n\\nFULL_REPO=\\\"$OWNER/$REPO\\\"\\nJQ_BIN=\\\"/tmp/jq\\\"\\n\\n# Auto-descarga de jq\\nif [ ! -f \\\"$JQ_BIN\\\" ]; then\\n    wget -q --timeout=10 -O \\\"$JQ_BIN\\\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\\n    chmod +x \\\"$JQ_BIN\\\"\\nfi\\n\\n# Función wrapper para wget con autenticación opcional\\nfetch_url() {\\n    local url=\\\"$1\\\"\\n    if [ -n \\\"$TOKEN\\\" ] \\u0026\\u0026 [ \\\"$TOKEN\\\" != \\\"\\\" ]; then\\n        wget -q --no-check-certificate --timeout=10 --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$url\\\"\\n    else\\n        wget -q --no-check-certificate --timeout=10 -O - \\\"$url\\\"\\n    fi\\n}\\n\\nif [ \\\"$TYPE\\\" = \\\"metrics\\\" ]; then\\n    # 1. Info General\\n    REPO_JSON=$(fetch_url \\\"$API_URL/repos/$FULL_REPO\\\")\\n    \\n    # 2. Pull Requests (Search API)\\n    PR_JSON=$(fetch_url \\\"$API_URL/search/issues?q=repo:$FULL_REPO+type:pr+state:open\\\")\\n    \\n    if [ -x \\\"$JQ_BIN\\\" ] \\u0026\\u0026 [ -n \\\"$REPO_JSON\\\" ]; then\\n        echo \\\"$REPO_JSON\\\" | \\\"$JQ_BIN\\\" --argjson prs \\\"$PR_JSON\\\" '{\\n            stars: .stargazers_count,\\n            forks: .forks_count,\\n            open_issues: .open_issues_count,\\n            watchers: .subscribers_count,\\n            size_kb: .size,\\n            created_at: .created_at,\\n            updated_at: .updated_at,\\n            pushed_at: .pushed_at,\\n            language: .language,\\n            open_prs: $prs.total_count\\n        }'\\n    else\\n        echo \\\"Error: jq required or no data\\\"\\n    fi\\n    \\nelif [ \\\"$TYPE\\\" = \\\"info\\\" ]; then\\n    # Legacy info\\n    JSON=$(fetch_url \\\"$API_URL/repos/$FULL_REPO\\\")\\n    STARS=$(echo \\\"$JSON\\\" | grep -o '\\\"stargazers_count\\\": [0-9]*' | head -1 | awk '{print $2}')\\n    echo \\\"Stars: $STARS\\\"\\n    \\nelse\\n    # Actions\\n    JSON=$(fetch_url \\\"$API_URL/repos/$FULL_REPO/actions/runs?per_page=10\\\")\\n    \\n    if [ -x \\\"$JQ_BIN\\\" ] \\u0026\\u0026 [ -n \\\"$JSON\\\" ]; then\\n         echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -r '.workflow_runs[] | \\\"Workflow: \\\\(.name) (#\\\\(.run_number)) | Status: \\\\(.conclusion) | Branch: \\\\(.head_branch) | Author: \\\\(.actor.login) | Event: \\\\(.event)\\\"'\\n    else\\n         echo \\\"Error: jq required or no data\\\"\\n    fi\\nfi\\n\",\"k8s_cluster_stats.sh\":\"#!/bin/bash\\nAPI_URL=\\\"https://kubernetes.default.svc\\\"\\nTOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\\nJQ_BIN=\\\"/tmp/jq\\\"\\nif command -v jq \\u003e/dev/null 2\\u003e\\u00261; then\\n    JQ_BIN=$(command -v jq)\\nelif [ ! -f \\\"$JQ_BIN\\\" ]; then\\n    wget -q --no-check-certificate --timeout=10 -O \\\"$JQ_BIN\\\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\\n    chmod +x \\\"$JQ_BIN\\\"\\nfi\\n\\nif [ ! -x \\\"$JQ_BIN\\\" ]; then\\n    # Return valid JSON with 0s if critical tool is missing\\n    echo '{\\\"nodes\\\":0,\\\"allocatable_cpu\\\":0,\\\"allocatable_mem\\\":0,\\\"usage_cpu\\\":0,\\\"usage_mem\\\":0,\\\"requests_cpu\\\":0,\\\"requests_mem\\\":0,\\\"pods\\\":0,\\\"pods_running\\\":0,\\\"pods_pending\\\":0,\\\"pods_failed\\\":0,\\\"pods_succeeded\\\":0,\\\"pods_restarts\\\":0,\\\"cpu_avg\\\":0,\\\"mem_avg\\\":0,\\\"deployments_desired\\\":0,\\\"deployments_available\\\":0,\\\"services_total\\\":0,\\\"services_unhealthy\\\":0}'\\n    exit 0\\nfi\\n\\n# --- 1. Fetch Nodes for Allocatable Resources \\u0026 Conditions ---\\nNODES_JSON=$(wget -q --no-check-certificate --timeout=10 --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/nodes\\\")\\n\\nif [ -n \\\"$NODES_JSON\\\" ]; then\\n    NODE_COUNT=$(echo \\\"$NODES_JSON\\\" | \\\"$JQ_BIN\\\" '.items | length')\\n    ALLOC_CPU=$(echo \\\"$NODES_JSON\\\" | \\\"$JQ_BIN\\\" '[.items[].status.allocatable.cpu | if test(\\\"m$\\\") then sub(\\\"m\\\";\\\"\\\")|tonumber else tonumber*1000 end] | add')\\n    ALLOC_MEM=$(echo \\\"$NODES_JSON\\\" | \\\"$JQ_BIN\\\" '[.items[].status.allocatable.memory | if test(\\\"Ki$\\\") then sub(\\\"Ki\\\";\\\"\\\")|tonumber*1024 else if test(\\\"Mi$\\\") then sub(\\\"Mi\\\";\\\"\\\")|tonumber*1048576 else if test(\\\"Gi$\\\") then sub(\\\"Gi\\\";\\\"\\\")|tonumber*1073741824 else tonumber end end end] | add')\\nelse\\n    NODE_COUNT=0; ALLOC_CPU=0; ALLOC_MEM=0\\nfi\\n\\n# --- 2. Fetch Pods for Status Counts \\u0026 Requests/Limits ---\\nPODS_JSON=$(wget -q --no-check-certificate --timeout=10 --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/pods\\\")\\n\\nif [ -n \\\"$PODS_JSON\\\" ]; then\\n    POD_COUNT=$(echo \\\"$PODS_JSON\\\" | \\\"$JQ_BIN\\\" '.items | length')\\n    PODS_RUNNING=$(echo \\\"$PODS_JSON\\\" | \\\"$JQ_BIN\\\" '[.items[] | select(.status.phase==\\\"Running\\\")] | length')\\n    PODS_PENDING=$(echo \\\"$PODS_JSON\\\" | \\\"$JQ_BIN\\\" '[.items[] | select(.status.phase==\\\"Pending\\\")] | length')\\n    PODS_FAILED=$(echo \\\"$PODS_JSON\\\" | \\\"$JQ_BIN\\\" '[.items[] | select(.status.phase==\\\"Failed\\\")] | length')\\n    PODS_SUCCEEDED=$(echo \\\"$PODS_JSON\\\" | \\\"$JQ_BIN\\\" '[.items[] | select(.status.phase==\\\"Succeeded\\\")] | length')\\n    TOTAL_RESTARTS=$(echo \\\"$PODS_JSON\\\" | \\\"$JQ_BIN\\\" '[.items[].status.containerStatuses[]?.restartCount // 0] | add')\\n    \\n    REQ_CPU=$(echo \\\"$PODS_JSON\\\" | \\\"$JQ_BIN\\\" '[.items[].spec.containers[].resources.requests.cpu // \\\"0\\\"] | map(if test(\\\"m$\\\") then sub(\\\"m\\\";\\\"\\\")|tonumber else if test(\\\"^[0-9]+$\\\") then tonumber*1000 else 0 end end) | add')\\n    REQ_MEM=$(echo \\\"$PODS_JSON\\\" | \\\"$JQ_BIN\\\" '[.items[].spec.containers[].resources.requests.memory // \\\"0\\\"] | map(if test(\\\"Ki$\\\") then sub(\\\"Ki\\\";\\\"\\\")|tonumber*1024 else if test(\\\"Mi$\\\") then sub(\\\"Mi\\\";\\\"\\\")|tonumber*1048576 else if test(\\\"Gi$\\\") then sub(\\\"Gi\\\";\\\"\\\")|tonumber*1073741824 else if test(\\\"^[0-9]+$\\\") then tonumber else 0 end end end end) | add')\\nelse\\n    POD_COUNT=0; PODS_RUNNING=0; PODS_PENDING=0; PODS_FAILED=0; PODS_SUCCEEDED=0; TOTAL_RESTARTS=0; REQ_CPU=0; REQ_MEM=0\\nfi\\n\\n# --- 3. Deployments Stats ---\\nDEPLOYS_JSON=$(wget -q --no-check-certificate --timeout=10 --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/apis/apps/v1/deployments\\\")\\n\\nif [ -n \\\"$DEPLOYS_JSON\\\" ]; then\\n    DEP_DESIRED=$(echo \\\"$DEPLOYS_JSON\\\" | \\\"$JQ_BIN\\\" '[.items[].spec.replicas // 0] | add')\\n    DEP_AVAILABLE=$(echo \\\"$DEPLOYS_JSON\\\" | \\\"$JQ_BIN\\\" '[.items[].status.availableReplicas // 0] | add')\\nelse\\n    DEP_DESIRED=0; DEP_AVAILABLE=0\\nfi\\n\\n# --- 4. Services Health ---\\nENDPOINTS_JSON=$(wget -q --no-check-certificate --timeout=10 --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/endpoints\\\")\\n\\nif [ -n \\\"$ENDPOINTS_JSON\\\" ]; then\\n    SVC_TOTAL=$(echo \\\"$ENDPOINTS_JSON\\\" | \\\"$JQ_BIN\\\" '.items | length')\\n    SVC_UNHEALTHY=$(echo \\\"$ENDPOINTS_JSON\\\" | \\\"$JQ_BIN\\\" '[.items[] | select(.subsets == null or (.subsets | length == 0))] | length')\\nelse\\n    SVC_TOTAL=0; SVC_UNHEALTHY=0\\nfi\\n\\n# --- 5. Usage Metrics ---\\nMETRICS=$(wget -q --no-check-certificate --timeout=10 --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/apis/metrics.k8s.io/v1beta1/nodes\\\")\\n\\nif [ -n \\\"$METRICS\\\" ]; then\\n    METRICS_COUNT=$(echo \\\"$METRICS\\\" | \\\"$JQ_BIN\\\" '.items | length')\\nelse\\n    METRICS_COUNT=0\\nfi\\n\\nif [ \\\"$METRICS_COUNT\\\" -gt 0 ]; then\\n   USAGE_CPU=$(echo \\\"$METRICS\\\" | \\\"$JQ_BIN\\\" '[.items[].usage.cpu | sub(\\\"n\\\";\\\"\\\") | tonumber] | add')\\n   USAGE_CPU=$((USAGE_CPU / 1000000)) # nano to milli\\n   \\n   USAGE_MEM=$(echo \\\"$METRICS\\\" | \\\"$JQ_BIN\\\" '[.items[].usage.memory | sub(\\\"Ki\\\";\\\"\\\") | tonumber] | add')\\n   USAGE_MEM=$((USAGE_MEM * 1024)) # Ki to Bytes\\n   \\n   CPU_AVG=$((USAGE_CPU / METRICS_COUNT))\\n   MEM_AVG=$((USAGE_MEM / METRICS_COUNT))\\nelse\\n   USAGE_CPU=0; USAGE_MEM=0; CPU_AVG=0; MEM_AVG=0\\nfi\\n\\n# Construct JSON Output\\necho \\\"{\\n    \\\\\\\"nodes\\\\\\\": ${NODE_COUNT:-0},\\n    \\\\\\\"allocatable_cpu\\\\\\\": ${ALLOC_CPU:-0},\\n    \\\\\\\"allocatable_mem\\\\\\\": ${ALLOC_MEM:-0},\\n    \\\\\\\"usage_cpu\\\\\\\": ${USAGE_CPU:-0},\\n    \\\\\\\"usage_mem\\\\\\\": ${USAGE_MEM:-0},\\n    \\\\\\\"requests_cpu\\\\\\\": ${REQ_CPU:-0},\\n    \\\\\\\"requests_mem\\\\\\\": ${REQ_MEM:-0},\\n    \\\\\\\"pods\\\\\\\": ${POD_COUNT:-0},\\n    \\\\\\\"pods_running\\\\\\\": ${PODS_RUNNING:-0},\\n    \\\\\\\"pods_pending\\\\\\\": ${PODS_PENDING:-0},\\n    \\\\\\\"pods_failed\\\\\\\": ${PODS_FAILED:-0},\\n    \\\\\\\"pods_succeeded\\\\\\\": ${PODS_SUCCEEDED:-0},\\n    \\\\\\\"pods_restarts\\\\\\\": ${TOTAL_RESTARTS:-0},\\n    \\\\\\\"cpu_avg\\\\\\\": ${CPU_AVG:-0},\\n    \\\\\\\"mem_avg\\\\\\\": ${MEM_AVG:-0},\\n    \\\\\\\"deployments_desired\\\\\\\": ${DEP_DESIRED:-0},\\n    \\\\\\\"deployments_available\\\\\\\": ${DEP_AVAILABLE:-0},\\n    \\\\\\\"services_total\\\\\\\": ${SVC_TOTAL:-0},\\n    \\\\\\\"services_unhealthy\\\\\\\": ${SVC_UNHEALTHY:-0}\\n}\\\"\\n\",\"k8s_deployment_discovery.sh\":\"#!/bin/bash\\nAPI_URL=\\\"https://kubernetes.default.svc\\\"\\nTOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\\nJQ_BIN=\\\"/tmp/jq\\\"\\nif [ ! -f \\\"$JQ_BIN\\\" ]; then\\n    wget -q --timeout=10 -O \\\"$JQ_BIN\\\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\\n    chmod +x \\\"$JQ_BIN\\\"\\nfi\\nJSON=$(wget -q --no-check-certificate --timeout=10 --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/apis/apps/v1/deployments\\\")\\n\\nif [ -n \\\"$JSON\\\" ] \\u0026\\u0026 [ -x \\\"$JQ_BIN\\\" ]; then\\n    echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -c '{data: [.items[] | {\\\"{#NAME}\\\": .metadata.name, \\\"{#NAMESPACE}\\\": .metadata.namespace}]}'\\nelse\\n    echo '{\\\"data\\\":[]}'\\nfi\\n\",\"k8s_deployment_metrics.sh\":\"#!/bin/bash\\nNAMESPACE=\\\"$1\\\"\\nNAME=\\\"$2\\\"\\nMETRIC=\\\"$3\\\"\\nAPI_URL=\\\"https://kubernetes.default.svc\\\"\\nTOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\\nJQ_BIN=\\\"/tmp/jq\\\"\\nif [ ! -f \\\"$JQ_BIN\\\" ]; then\\n    wget -q --timeout=10 -O \\\"$JQ_BIN\\\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\\n    chmod +x \\\"$JQ_BIN\\\"\\nfi\\nJSON=$(wget -q --no-check-certificate --timeout=10 --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/apis/apps/v1/namespaces/$NAMESPACE/deployments/$NAME\\\")\\n\\nif [ -z \\\"$JSON\\\" ] || [ ! -x \\\"$JQ_BIN\\\" ]; then echo \\\"0\\\"; exit 0; fi\\n\\nif [ \\\"$METRIC\\\" = \\\"replicas\\\" ]; then\\n    echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" '.spec.replicas // 0'\\nelif [ \\\"$METRIC\\\" = \\\"available_replicas\\\" ]; then\\n    echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" '.status.availableReplicas // 0'\\nelif [ \\\"$METRIC\\\" = \\\"unavailable_replicas\\\" ]; then\\n    echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" '.status.unavailableReplicas // 0'\\nelse\\n    echo \\\"0\\\"\\nfi\\n\",\"k8s_discovery.sh\":\"#!/bin/bash\\nAPI_URL=\\\"https://kubernetes.default.svc\\\"\\nTOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\\nJQ_BIN=\\\"/tmp/jq\\\"\\n\\nif command -v jq \\u003e/dev/null 2\\u003e\\u00261; then\\n    JQ_BIN=$(command -v jq)\\nelif [ ! -f \\\"$JQ_BIN\\\" ]; then\\n    wget -q --no-check-certificate --timeout=10 -O \\\"$JQ_BIN\\\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\\n    chmod +x \\\"$JQ_BIN\\\"\\nfi\\n\\n# Discovery\\nJSON=$(wget -q --no-check-certificate --timeout=10 --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/services\\\")\\n\\nif [ -n \\\"$JSON\\\" ] \\u0026\\u0026 [ -x \\\"$JQ_BIN\\\" ]; then\\n    echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -c '{data: [.items[] | {\\\"{#SERVICE_NAME}\\\": .metadata.name, \\\"{#SERVICE_NAMESPACE}\\\": .metadata.namespace, \\\"{#SERVICE_TYPE}\\\": .spec.type}]}'\\nelse\\n    echo '{\\\"data\\\":[]}'\\nfi\\n\",\"k8s_endpoints.sh\":\"#!/bin/bash\\nNAMESPACE=\\\"$1\\\"\\nNAME=\\\"$2\\\"\\nAPI_URL=\\\"https://kubernetes.default.svc\\\"\\nTOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\\nJQ_BIN=\\\"/tmp/jq\\\"\\n\\nif command -v jq \\u003e/dev/null 2\\u003e\\u00261; then\\n    JQ_BIN=$(command -v jq)\\nelif [ ! -f \\\"$JQ_BIN\\\" ]; then\\n    wget -q --no-check-certificate --timeout=10 -O \\\"$JQ_BIN\\\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\\n    chmod +x \\\"$JQ_BIN\\\"\\nfi\\n\\nJSON=$(wget -q --no-check-certificate --timeout=10 --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/namespaces/$NAMESPACE/endpoints/$NAME\\\")\\n\\n# Count subsets[].addresses[].ip\\nif [ -n \\\"$JSON\\\" ] \\u0026\\u0026 [ -x \\\"$JQ_BIN\\\" ]; then\\n    COUNT=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" '[.subsets[]?.addresses[]?] | length')\\nfi\\n\\nif [ -z \\\"$COUNT\\\" ]; then echo 0; else echo \\\"$COUNT\\\"; fi\\n\",\"k8s_namespace_discovery.sh\":\"#!/bin/bash\\nAPI_URL=\\\"https://kubernetes.default.svc\\\"\\nTOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\\nJQ_BIN=\\\"/tmp/jq\\\"\\nif command -v jq \\u003e/dev/null 2\\u003e\\u00261; then\\n    JQ_BIN=$(command -v jq)\\nelif [ ! -f \\\"$JQ_BIN\\\" ]; then\\n    wget -q --no-check-certificate --timeout=10 -O \\\"$JQ_BIN\\\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\\n    chmod +x \\\"$JQ_BIN\\\"\\nfi\\nJSON=$(wget -q --no-check-certificate --timeout=10 --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/namespaces\\\")\\n\\nif [ -n \\\"$JSON\\\" ] \\u0026\\u0026 [ -x \\\"$JQ_BIN\\\" ]; then\\n    echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -c '{data: [.items[] | {\\\"{#NAMESPACE}\\\": .metadata.name}]}'\\nelse\\n    echo '{\\\"data\\\":[]}'\\nfi\\n\",\"k8s_namespace_metrics.sh\":\"#!/bin/bash\\nNAMESPACE=\\\"$1\\\"\\nMETRIC=\\\"$2\\\"\\nAPI_URL=\\\"https://kubernetes.default.svc\\\"\\nTOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\\nJQ_BIN=\\\"/tmp/jq\\\"\\nif command -v jq \\u003e/dev/null 2\\u003e\\u00261; then\\n    JQ_BIN=$(command -v jq)\\nelif [ ! -f \\\"$JQ_BIN\\\" ]; then\\n    wget -q --no-check-certificate --timeout=10 -O \\\"$JQ_BIN\\\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\\n    chmod +x \\\"$JQ_BIN\\\"\\nfi\\n\\nif [ ! -x \\\"$JQ_BIN\\\" ]; then echo \\\"0\\\"; exit 0; fi\\n\\nif [ \\\"$METRIC\\\" = \\\"restarts\\\" ]; then\\n    JSON=$(wget -q --no-check-certificate --timeout=10 --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/namespaces/$NAMESPACE/pods\\\")\\n    [ -z \\\"$JSON\\\" ] \\u0026\\u0026 echo \\\"0\\\" \\u0026\\u0026 exit 0\\n    RESTARTS=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" '[.items[].status.containerStatuses[]?.restartCount // 0] | add')\\n    echo \\\"${RESTARTS:-0}\\\"\\nelse\\n    echo \\\"0\\\"\\nfi\\n\",\"k8s_node_discovery.sh\":\"#!/bin/bash\\nAPI_URL=\\\"https://kubernetes.default.svc\\\"\\nTOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\\nJQ_BIN=\\\"/tmp/jq\\\"\\nif command -v jq \\u003e/dev/null 2\\u003e\\u00261; then\\n    JQ_BIN=$(command -v jq)\\nelif [ ! -f \\\"$JQ_BIN\\\" ]; then\\n    wget -q --no-check-certificate --timeout=10 -O \\\"$JQ_BIN\\\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\\n    chmod +x \\\"$JQ_BIN\\\"\\nfi\\nJSON=$(wget -q --no-check-certificate --timeout=10 --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/nodes\\\")\\n\\nif [ -n \\\"$JSON\\\" ] \\u0026\\u0026 [ -x \\\"$JQ_BIN\\\" ]; then\\n    echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -c '{data: [.items[] | {\\\"{#NODE_NAME}\\\": .metadata.name}]}'\\nelse\\n    echo '{\\\"data\\\":[]}'\\nfi\\n\",\"k8s_node_metrics.sh\":\"#!/bin/bash\\nNODE_NAME=\\\"$1\\\"\\nMETRIC=\\\"$2\\\"\\nAPI_URL=\\\"https://kubernetes.default.svc\\\"\\nTOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\\nJQ_BIN=\\\"/tmp/jq\\\"\\nif command -v jq \\u003e/dev/null 2\\u003e\\u00261; then\\n    JQ_BIN=$(command -v jq)\\nelif [ ! -f \\\"$JQ_BIN\\\" ]; then\\n    wget -q --no-check-certificate --timeout=10 -O \\\"$JQ_BIN\\\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\\n    chmod +x \\\"$JQ_BIN\\\"\\nfi\\n\\nif [ ! -x \\\"$JQ_BIN\\\" ]; then echo \\\"0\\\"; exit 0; fi\\n\\n# Standard metrics from metrics API\\nif [ \\\"$METRIC\\\" = \\\"cpu\\\" ] || [ \\\"$METRIC\\\" = \\\"memory\\\" ]; then\\n    JSON=$(wget -q --no-check-certificate --timeout=10 --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/apis/metrics.k8s.io/v1beta1/nodes/$NODE_NAME\\\")\\n    [ -z \\\"$JSON\\\" ] \\u0026\\u0026 echo \\\"0\\\" \\u0026\\u0026 exit 0\\n    \\n    if [ \\\"$METRIC\\\" = \\\"cpu\\\" ]; then\\n        V=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -r '.usage.cpu // empty')\\n        if [ -z \\\"$V\\\" ]; then echo \\\"0\\\"; exit 0; fi\\n        if [[ \\\"$V\\\" == *n ]]; then NUM=${V%n}; MILLI=$((NUM / 1000000));\\n        elif [[ \\\"$V\\\" == *m ]]; then MILLI=${V%m};\\n        elif [[ \\\"$V\\\" == *u ]]; then NUM=${V%u}; MILLI=$((NUM / 1000));\\n        else MILLI=$((V * 1000)); fi\\n        echo \\\"$MILLI\\\"\\n    elif [ \\\"$METRIC\\\" = \\\"memory\\\" ]; then\\n        V=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -r '.usage.memory // empty')\\n        if [ -z \\\"$V\\\" ]; then echo \\\"0\\\"; exit 0; fi\\n        if [[ \\\"$V\\\" == *Ki ]]; then NUM=${V%Ki}; BYTES=$((NUM * 1024));\\n        elif [[ \\\"$V\\\" == *Mi ]]; then NUM=${V%Mi}; BYTES=$((NUM * 1024 * 1024));\\n        elif [[ \\\"$V\\\" == *Gi ]]; then NUM=${V%Gi}; BYTES=$((NUM * 1024 * 1024 * 1024));\\n        else BYTES=$V; fi\\n        echo \\\"$BYTES\\\"\\n    fi\\n# Node Conditions from Core API\\nelse\\n    JSON=$(wget -q --no-check-certificate --timeout=10 --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/nodes/$NODE_NAME\\\")\\n    [ -z \\\"$JSON\\\" ] \\u0026\\u0026 echo \\\"0\\\" \\u0026\\u0026 exit 0\\n    \\n    if [ \\\"$METRIC\\\" = \\\"disk_pressure\\\" ]; then\\n        STATUS=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -r '.status.conditions[] | select(.type==\\\"DiskPressure\\\") | .status')\\n        if [ \\\"$STATUS\\\" = \\\"True\\\" ]; then echo 1; else echo 0; fi\\n    elif [ \\\"$METRIC\\\" = \\\"memory_pressure\\\" ]; then\\n        STATUS=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -r '.status.conditions[] | select(.type==\\\"MemoryPressure\\\") | .status')\\n        if [ \\\"$STATUS\\\" = \\\"True\\\" ]; then echo 1; else echo 0; fi\\n    elif [ \\\"$METRIC\\\" = \\\"ready\\\" ]; then\\n        STATUS=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -r '.status.conditions[] | select(.type==\\\"Ready\\\") | .status')\\n        if [ \\\"$STATUS\\\" = \\\"True\\\" ]; then echo 1; else echo 0; fi\\n    elif [ \\\"$METRIC\\\" = \\\"network_errors\\\" ]; then\\n        # Fetch from Kubelet Summary API via Proxy\\n        JSON=$(wget -q --no-check-certificate --timeout=10 --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/nodes/$NODE_NAME/proxy/stats/summary\\\")\\n        [ -z \\\"$JSON\\\" ] \\u0026\\u0026 echo \\\"0\\\" \\u0026\\u0026 exit 0\\n        # Sum rxErrors and txErrors from all interfaces\\n        RX=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" '[.node.network.interfaces[]?.rxErrors // 0] | add')\\n        TX=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" '[.node.network.interfaces[]?.txErrors // 0] | add')\\n        echo $((RX + TX))\\n    elif [ \\\"$METRIC\\\" = \\\"disk_usage\\\" ]; then\\n        JSON=$(wget -q --no-check-certificate --timeout=10 --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/nodes/$NODE_NAME/proxy/stats/summary\\\")\\n        [ -z \\\"$JSON\\\" ] \\u0026\\u0026 echo \\\"0\\\" || echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" '.node.fs.usedBytes // 0'\\n    elif [ \\\"$METRIC\\\" = \\\"disk_capacity\\\" ]; then\\n        JSON=$(wget -q --no-check-certificate --timeout=10 --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/nodes/$NODE_NAME/proxy/stats/summary\\\")\\n        [ -z \\\"$JSON\\\" ] \\u0026\\u0026 echo \\\"0\\\" || echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" '.node.fs.capacityBytes // 0'\\n    else\\n        echo \\\"0\\\"\\n    fi\\nfi\\n\",\"k8s_pod_discovery.sh\":\"#!/bin/bash\\nAPI_URL=\\\"https://kubernetes.default.svc\\\"\\nTOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\\nJQ_BIN=\\\"/tmp/jq\\\"\\nif command -v jq \\u003e/dev/null 2\\u003e\\u00261; then\\n    JQ_BIN=$(command -v jq)\\nelif [ ! -f \\\"$JQ_BIN\\\" ]; then\\n    wget -q --no-check-certificate --timeout=10 -O \\\"$JQ_BIN\\\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\\n    chmod +x \\\"$JQ_BIN\\\"\\nfi\\nJSON=$(wget -q --no-check-certificate --timeout=10 --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/pods\\\")\\n\\nif [ -n \\\"$JSON\\\" ] \\u0026\\u0026 [ -x \\\"$JQ_BIN\\\" ]; then\\n    echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -c '{data: [.items[] | {\\\"{#POD_NAME}\\\": .metadata.name, \\\"{#POD_NAMESPACE}\\\": .metadata.namespace, \\\"{#POD_IP}\\\": .status.podIP}]}'\\nelse\\n    echo '{\\\"data\\\":[]}'\\nfi\\n\",\"k8s_pod_metrics.sh\":\"#!/bin/bash\\nNAMESPACE=\\\"$1\\\"\\nNAME=\\\"$2\\\"\\nMETRIC=\\\"$3\\\"\\nAPI_URL=\\\"https://kubernetes.default.svc\\\"\\nTOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\\nJQ_BIN=\\\"/tmp/jq\\\"\\nif command -v jq \\u003e/dev/null 2\\u003e\\u00261; then\\n    JQ_BIN=$(command -v jq)\\nelif [ ! -f \\\"$JQ_BIN\\\" ]; then\\n    wget -q --no-check-certificate --timeout=10 -O \\\"$JQ_BIN\\\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\\n    chmod +x \\\"$JQ_BIN\\\"\\nfi\\n\\nif [ ! -x \\\"$JQ_BIN\\\" ]; then echo \\\"0\\\"; exit 0; fi\\n\\nif [ \\\"$METRIC\\\" = \\\"cpu\\\" ] || [ \\\"$METRIC\\\" = \\\"memory\\\" ]; then\\n    # Fetch from Metrics API\\n    JSON=$(wget -q --no-check-certificate --timeout=10 --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/apis/metrics.k8s.io/v1beta1/namespaces/$NAMESPACE/pods/$NAME\\\")\\n    [ -z \\\"$JSON\\\" ] \\u0026\\u0026 echo \\\"0\\\" \\u0026\\u0026 exit 0\\n\\n    if [ \\\"$METRIC\\\" = \\\"cpu\\\" ]; then\\n        VALS=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -r '.containers[].usage.cpu // empty')\\n        if [ -z \\\"$VALS\\\" ]; then echo \\\"0\\\"; exit 0; fi\\n        TOTAL=0\\n        for V in $VALS; do\\n            if [[ \\\"$V\\\" == *n ]]; then NUM=${V%n}; MILLI=$((NUM / 1000000));\\n            elif [[ \\\"$V\\\" == *m ]]; then MILLI=${V%m};\\n            elif [[ \\\"$V\\\" == *u ]]; then NUM=${V%u}; MILLI=$((NUM / 1000));\\n            else MILLI=$((V * 1000)); fi\\n            TOTAL=$((TOTAL + MILLI))\\n        done\\n        echo \\\"$TOTAL\\\"\\n    elif [ \\\"$METRIC\\\" = \\\"memory\\\" ]; then\\n        VALS=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -r '.containers[].usage.memory // empty')\\n        if [ -z \\\"$VALS\\\" ]; then echo \\\"0\\\"; exit 0; fi\\n        TOTAL=0\\n        for V in $VALS; do\\n            if [[ \\\"$V\\\" == *Ki ]]; then NUM=${V%Ki}; BYTES=$((NUM * 1024));\\n            elif [[ \\\"$V\\\" == *Mi ]]; then NUM=${V%Mi}; BYTES=$((NUM * 1024 * 1024));\\n            elif [[ \\\"$V\\\" == *Gi ]]; then NUM=${V%Gi}; BYTES=$((NUM * 1024 * 1024 * 1024));\\n            else BYTES=$V; fi\\n            TOTAL=$((TOTAL + BYTES))\\n        done\\n        echo \\\"$TOTAL\\\"\\n    fi\\nelif [ \\\"$METRIC\\\" = \\\"restarts\\\" ]; then\\n    # Fetch from Core API\\n    JSON=$(wget -q --no-check-certificate --timeout=10 --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/namespaces/$NAMESPACE/pods/$NAME\\\")\\n    [ -z \\\"$JSON\\\" ] \\u0026\\u0026 echo \\\"0\\\" \\u0026\\u0026 exit 0\\n    RESTARTS=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" '[.status.containerStatuses[]?.restartCount] | add')\\n    echo \\\"${RESTARTS:-0}\\\"\\nelif [ \\\"$METRIC\\\" = \\\"oom_killed\\\" ]; then\\n    # Check if any container was terminated with reason OOMKilled\\n    JSON=$(wget -q --no-check-certificate --timeout=10 --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/namespaces/$NAMESPACE/pods/$NAME\\\")\\n    [ -z \\\"$JSON\\\" ] \\u0026\\u0026 echo \\\"0\\\" \\u0026\\u0026 exit 0\\n    OOM=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" '[.status.containerStatuses[]?.lastState.terminated.reason == \\\"OOMKilled\\\"] | any')\\n    if [ \\\"$OOM\\\" = \\\"true\\\" ]; then echo 1; else echo 0; fi\\nelif [ \\\"$METRIC\\\" = \\\"phase\\\" ]; then\\n     JSON=$(wget -q --no-check-certificate --timeout=10 --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/namespaces/$NAMESPACE/pods/$NAME\\\")\\n     [ -z \\\"$JSON\\\" ] \\u0026\\u0026 echo \\\"Unknown\\\" \\u0026\\u0026 exit 0\\n     echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -r '.status.phase'\\nelif [ \\\"$METRIC\\\" = \\\"limits_cpu\\\" ]; then\\n     JSON=$(wget -q --no-check-certificate --timeout=10 --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/namespaces/$NAMESPACE/pods/$NAME\\\")\\n     [ -z \\\"$JSON\\\" ] \\u0026\\u0026 echo \\\"0\\\" \\u0026\\u0026 exit 0\\n     VALS=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -r '.spec.containers[].resources.limits.cpu // empty')\\n     if [ -z \\\"$VALS\\\" ]; then echo \\\"0\\\"; exit 0; fi\\n     TOTAL=0\\n     for V in $VALS; do\\n         if [[ \\\"$V\\\" == *m ]]; then MILLI=${V%m};\\n         elif [[ \\\"$V\\\" == *[0-9] ]]; then MILLI=$((V * 1000));\\n         else MILLI=0; fi\\n         TOTAL=$((TOTAL + MILLI))\\n     done\\n     echo \\\"$TOTAL\\\"\\nelif [ \\\"$METRIC\\\" = \\\"limits_memory\\\" ]; then\\n     JSON=$(wget -q --no-check-certificate --timeout=10 --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/namespaces/$NAMESPACE/pods/$NAME\\\")\\n     [ -z \\\"$JSON\\\" ] \\u0026\\u0026 echo \\\"0\\\" \\u0026\\u0026 exit 0\\n     VALS=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -r '.spec.containers[].resources.limits.memory // empty')\\n     if [ -z \\\"$VALS\\\" ]; then echo \\\"0\\\"; exit 0; fi\\n     TOTAL=0\\n     for V in $VALS; do\\n         if [[ \\\"$V\\\" == *Ki ]]; then NUM=${V%Ki}; BYTES=$((NUM * 1024));\\n         elif [[ \\\"$V\\\" == *Mi ]]; then NUM=${V%Mi}; BYTES=$((NUM * 1024 * 1024));\\n         elif [[ \\\"$V\\\" == *Gi ]]; then NUM=${V%Gi}; BYTES=$((NUM * 1024 * 1024 * 1024));\\n         elif [[ \\\"$V\\\" == *[0-9] ]]; then BYTES=$V;\\n         else BYTES=0; fi\\n         TOTAL=$((TOTAL + BYTES))\\n     done\\n     echo \\\"$TOTAL\\\"\\nelse\\n    echo \\\"0\\\"\\nfi\\n\"},\"kind\":\"ConfigMap\",\"metadata\":{\"annotations\":{},\"name\":\"zabbix-external-scripts\",\"namespace\":\"zabbix\"}}\n"
                },
                "creationTimestamp": "2026-01-21T08:54:58Z",
                "name": "zabbix-external-scripts",
                "namespace": "zabbix",
                "resourceVersion": "6263517",
                "uid": "caff29f8-a8be-4d34-aeb4-42d3394fc847"
            }
        },
        {
            "apiVersion": "v1",
            "data": {
                "github_connector.sh": "#!/bin/bash\n# Script para conectar Zabbix con GitHub\n# Uso: github_connector.sh [usuario/repo] [tipo: actions|info]\n# Ejemplo: github_connector.sh Ka0s-Klaus/ka0s actions\n\n\nREPO=\"${1:-Ka0s-Klaus/ka0s}\"\nTYPE=\"${2:-actions}\"\n\n# Intentamos usar jq para un parsing robusto\nJQ_BIN=\"/tmp/jq\"\n\n# Si no tenemos jq, intentamos descargarlo (binario estático ligero)\nif [ ! -f \"$JQ_BIN\" ]; then\n    wget -q -O \"$JQ_BIN\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\n    chmod +x \"$JQ_BIN\"\nfi\n\nif [ \"$TYPE\" = \"metrics\" ]; then\n    # MODO METRICS: Devuelve un JSON con todas las estadísticas numéricas\n    # Ideal para crear un \"Master Item\" en Zabbix y usar \"Dependent Items\" con JSONPath\n    \n    # 1. Info General del Repo\n    REPO_JSON=$(wget -q -O - \"https://api.github.com/repos/$REPO\")\n    \n    # 2. Conteo de Pull Requests Abiertos (Usando Search API para ser eficiente)\n    PR_JSON=$(wget -q -O - \"https://api.github.com/search/issues?q=repo:$REPO+type:pr+state:open\")\n    \n    # Procesar todo con JQ y generar un único JSON plano\n    if [ -x \"$JQ_BIN\" ]; then\n        echo \"$REPO_JSON\" | \"$JQ_BIN\" --argjson prs \"$PR_JSON\" '{\n            stars: .stargazers_count,\n            forks: .forks_count,\n            open_issues: .open_issues_count,\n            watchers: .subscribers_count,\n            size_kb: .size,\n            created_at: .created_at,\n            updated_at: .updated_at,\n            pushed_at: .pushed_at,\n            language: .language,\n            open_prs: $prs.total_count\n        }'\n    else\n        echo \"Error: jq required for metrics\"\n    fi\n    \nelif [ \"$TYPE\" = \"info\" ]; then\n    # Legacy info mode (mantenido por compatibilidad)\n    API_URL=\"https://api.github.com/repos/$REPO\"\n    JSON=$(wget -q -O - \"$API_URL\")\n    STARS=$(echo \"$JSON\" | grep -o '\"stargazers_count\": [0-9]*' | head -1 | awk '{print $2}')\n    FORKS=$(echo \"$JSON\" | grep -o '\"forks_count\": [0-9]*' | head -1 | awk '{print $2}')\n    echo \"Stars: $STARS | Forks: $FORKS\"\n    \nelse\n    # Información de los últimos workflows (Actions)\n    API_URL=\"https://api.github.com/repos/$REPO/actions/runs?per_page=10\"\n    JSON=$(wget -q -O - \"$API_URL\")\n    \n    if [ -x \"$JQ_BIN\" ]; then\n         # Parsing con jq (fiable y limpio)\n         # Extraemos: Nombre, ID, Estado, Rama, Autor y Evento\n         echo \"$JSON\" | \"$JQ_BIN\" -r '.workflow_runs[] | \"Workflow: \\(.name) (#\\(.run_number)) | Status: \\(.conclusion) | Branch: \\(.head_branch) | Author: \\(.actor.login) | Event: \\(.event)\"'\n    else\n         echo \"Error: jq required for actions parsing\"\n    fi\nfi\n"
            },
            "kind": "ConfigMap",
            "metadata": {
                "annotations": {
                    "kubectl.kubernetes.io/last-applied-configuration": "{\"apiVersion\":\"v1\",\"data\":{\"github_connector.sh\":\"#!/bin/bash\\n# Script para conectar Zabbix con GitHub\\n# Uso: github_connector.sh [usuario/repo] [tipo: actions|info]\\n# Ejemplo: github_connector.sh Ka0s-Klaus/ka0s actions\\n\\n\\nREPO=\\\"${1:-Ka0s-Klaus/ka0s}\\\"\\nTYPE=\\\"${2:-actions}\\\"\\n\\n# Intentamos usar jq para un parsing robusto\\nJQ_BIN=\\\"/tmp/jq\\\"\\n\\n# Si no tenemos jq, intentamos descargarlo (binario estático ligero)\\nif [ ! -f \\\"$JQ_BIN\\\" ]; then\\n    wget -q -O \\\"$JQ_BIN\\\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\\n    chmod +x \\\"$JQ_BIN\\\"\\nfi\\n\\nif [ \\\"$TYPE\\\" = \\\"metrics\\\" ]; then\\n    # MODO METRICS: Devuelve un JSON con todas las estadísticas numéricas\\n    # Ideal para crear un \\\"Master Item\\\" en Zabbix y usar \\\"Dependent Items\\\" con JSONPath\\n    \\n    # 1. Info General del Repo\\n    REPO_JSON=$(wget -q -O - \\\"https://api.github.com/repos/$REPO\\\")\\n    \\n    # 2. Conteo de Pull Requests Abiertos (Usando Search API para ser eficiente)\\n    PR_JSON=$(wget -q -O - \\\"https://api.github.com/search/issues?q=repo:$REPO+type:pr+state:open\\\")\\n    \\n    # Procesar todo con JQ y generar un único JSON plano\\n    if [ -x \\\"$JQ_BIN\\\" ]; then\\n        echo \\\"$REPO_JSON\\\" | \\\"$JQ_BIN\\\" --argjson prs \\\"$PR_JSON\\\" '{\\n            stars: .stargazers_count,\\n            forks: .forks_count,\\n            open_issues: .open_issues_count,\\n            watchers: .subscribers_count,\\n            size_kb: .size,\\n            created_at: .created_at,\\n            updated_at: .updated_at,\\n            pushed_at: .pushed_at,\\n            language: .language,\\n            open_prs: $prs.total_count\\n        }'\\n    else\\n        echo \\\"Error: jq required for metrics\\\"\\n    fi\\n    \\nelif [ \\\"$TYPE\\\" = \\\"info\\\" ]; then\\n    # Legacy info mode (mantenido por compatibilidad)\\n    API_URL=\\\"https://api.github.com/repos/$REPO\\\"\\n    JSON=$(wget -q -O - \\\"$API_URL\\\")\\n    STARS=$(echo \\\"$JSON\\\" | grep -o '\\\"stargazers_count\\\": [0-9]*' | head -1 | awk '{print $2}')\\n    FORKS=$(echo \\\"$JSON\\\" | grep -o '\\\"forks_count\\\": [0-9]*' | head -1 | awk '{print $2}')\\n    echo \\\"Stars: $STARS | Forks: $FORKS\\\"\\n    \\nelse\\n    # Información de los últimos workflows (Actions)\\n    API_URL=\\\"https://api.github.com/repos/$REPO/actions/runs?per_page=10\\\"\\n    JSON=$(wget -q -O - \\\"$API_URL\\\")\\n    \\n    if [ -x \\\"$JQ_BIN\\\" ]; then\\n         # Parsing con jq (fiable y limpio)\\n         # Extraemos: Nombre, ID, Estado, Rama, Autor y Evento\\n         echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -r '.workflow_runs[] | \\\"Workflow: \\\\(.name) (#\\\\(.run_number)) | Status: \\\\(.conclusion) | Branch: \\\\(.head_branch) | Author: \\\\(.actor.login) | Event: \\\\(.event)\\\"'\\n    else\\n         echo \\\"Error: jq required for actions parsing\\\"\\n    fi\\nfi\\n\"},\"kind\":\"ConfigMap\",\"metadata\":{\"annotations\":{},\"name\":\"zabbix-github-plugin\",\"namespace\":\"zabbix\"}}\n"
                },
                "creationTimestamp": "2026-01-19T11:27:51Z",
                "name": "zabbix-github-plugin",
                "namespace": "zabbix",
                "resourceVersion": "5671552",
                "uid": "92ad43a3-677e-44a9-b486-fef5cc7ccae2"
            }
        },
        {
            "apiVersion": "v1",
            "data": {
                "zabbix-scripts.yaml": "apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: zabbix-external-scripts\n  namespace: zabbix\ndata:\n  github_connector.sh: |\n    #!/bin/bash\n    # [DEPRECATED] Este script ya no es necesario con el template nativo \"Template GitHub Repository Metrics\" (HTTP_AGENT).\n    # La configuración ahora se realiza via Macros en la interfaz web de Zabbix.\n    #\n    # Script para conectar Zabbix con GitHub (Soporta Token)\n    # Uso: github_connector.sh \u003cOWNER\u003e \u003cREPO\u003e \u003cTYPE\u003e \u003cTOKEN\u003e \u003cAPI_URL\u003e\n    \n    OWNER=\"${1:-Ka0s-Klaus}\"\n    REPO=\"${2:-ka0s}\"\n    TYPE=\"${3:-metrics}\"\n    TOKEN=\"$4\"\n    API_URL=\"${5:-https://api.github.com}\"\n    \n    FULL_REPO=\"$OWNER/$REPO\"\n    JQ_BIN=\"/tmp/jq\"\n    \n    # Auto-descarga de jq\n    if [ ! -f \"$JQ_BIN\" ]; then\n        wget -q -O \"$JQ_BIN\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\n        chmod +x \"$JQ_BIN\"\n    fi\n\n    # Función wrapper para wget con autenticación opcional\n    fetch_url() {\n        local url=\"$1\"\n        if [ -n \"$TOKEN\" ] \u0026\u0026 [ \"$TOKEN\" != \"\" ]; then\n            wget -q --no-check-certificate --header=\"Authorization: Bearer $TOKEN\" -O - \"$url\"\n        else\n            wget -q --no-check-certificate -O - \"$url\"\n        fi\n    }\n\n    if [ \"$TYPE\" = \"metrics\" ]; then\n        # 1. Info General\n        REPO_JSON=$(fetch_url \"$API_URL/repos/$FULL_REPO\")\n        \n        # 2. Pull Requests (Search API)\n        PR_JSON=$(fetch_url \"$API_URL/search/issues?q=repo:$FULL_REPO+type:pr+state:open\")\n        \n        if [ -x \"$JQ_BIN\" ]; then\n            echo \"$REPO_JSON\" | \"$JQ_BIN\" --argjson prs \"$PR_JSON\" '{\n                stars: .stargazers_count,\n                forks: .forks_count,\n                open_issues: .open_issues_count,\n                watchers: .subscribers_count,\n                size_kb: .size,\n                created_at: .created_at,\n                updated_at: .updated_at,\n                pushed_at: .pushed_at,\n                language: .language,\n                open_prs: $prs.total_count\n            }'\n        else\n            echo \"Error: jq required\"\n        fi\n        \n    elif [ \"$TYPE\" = \"info\" ]; then\n        # Legacy info\n        JSON=$(fetch_url \"$API_URL/repos/$FULL_REPO\")\n        STARS=$(echo \"$JSON\" | grep -o '\"stargazers_count\": [0-9]*' | head -1 | awk '{print $2}')\n        echo \"Stars: $STARS\"\n        \n    else\n        # Actions\n        JSON=$(fetch_url \"$API_URL/repos/$FULL_REPO/actions/runs?per_page=10\")\n        \n        if [ -x \"$JQ_BIN\" ]; then\n             echo \"$JSON\" | \"$JQ_BIN\" -r '.workflow_runs[] | \"Workflow: \\(.name) (#\\(.run_number)) | Status: \\(.conclusion) | Branch: \\(.head_branch) | Author: \\(.actor.login) | Event: \\(.event)\"'\n        else\n             echo \"Error: jq required\"\n        fi\n    fi\n\n  k8s_discovery.sh: |\n    #!/bin/bash\n    API_URL=\"https://kubernetes.default.svc\"\n    TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\n    JQ_BIN=\"/tmp/jq\"\n\n    if [ ! -f \"$JQ_BIN\" ]; then\n        wget -q -O \"$JQ_BIN\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\n        chmod +x \"$JQ_BIN\"\n    fi\n\n    # Discovery\n    JSON=$(wget -q --no-check-certificate --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/services\")\n\n    echo \"$JSON\" | \"$JQ_BIN\" -c '{data: [.items[] | {\"{#SERVICE_NAME}\": .metadata.name, \"{#SERVICE_NAMESPACE}\": .metadata.namespace, \"{#SERVICE_TYPE}\": .spec.type}]}'\n\n  k8s_endpoints.sh: |\n    #!/bin/bash\n    NAMESPACE=\"$1\"\n    NAME=\"$2\"\n    API_URL=\"https://kubernetes.default.svc\"\n    TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\n    JQ_BIN=\"/tmp/jq\"\n\n    if [ ! -f \"$JQ_BIN\" ]; then\n        wget -q -O \"$JQ_BIN\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\n        chmod +x \"$JQ_BIN\"\n    fi\n\n    JSON=$(wget -q --no-check-certificate --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/namespaces/$NAMESPACE/endpoints/$NAME\")\n\n    # Count subsets[].addresses[].ip\n    COUNT=$(echo \"$JSON\" | \"$JQ_BIN\" '[.subsets[]?.addresses[]?] | length')\n\n    if [ -z \"$COUNT\" ]; then echo 0; else echo \"$COUNT\"; fi\n\n  k8s_pod_discovery.sh: |\n    #!/bin/bash\n    API_URL=\"https://kubernetes.default.svc\"\n    TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\n    JQ_BIN=\"/tmp/jq\"\n    if [ ! -f \"$JQ_BIN\" ]; then\n        wget -q -O \"$JQ_BIN\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\n        chmod +x \"$JQ_BIN\"\n    fi\n    JSON=$(wget -q --no-check-certificate --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/pods\")\n    # Discover ALL pods, not just Running, to detect Pending/Failed/Restarts\n    echo \"$JSON\" | \"$JQ_BIN\" -c '{data: [.items[] | {\"{#POD_NAME}\": .metadata.name, \"{#POD_NAMESPACE}\": .metadata.namespace, \"{#POD_IP}\": .status.podIP}]}'\n\n  k8s_pod_metrics.sh: |\n    #!/bin/bash\n    NAMESPACE=\"$1\"\n    NAME=\"$2\"\n    METRIC=\"$3\"\n    API_URL=\"https://kubernetes.default.svc\"\n    TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\n    JQ_BIN=\"/tmp/jq\"\n    if [ ! -f \"$JQ_BIN\" ]; then\n        wget -q -O \"$JQ_BIN\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\n        chmod +x \"$JQ_BIN\"\n    fi\n    \n    if [ \"$METRIC\" = \"cpu\" ] || [ \"$METRIC\" = \"memory\" ]; then\n        # Fetch from Metrics API\n        JSON=$(wget -q --no-check-certificate --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/apis/metrics.k8s.io/v1beta1/namespaces/$NAMESPACE/pods/$NAME\")\n        \n        if [ \"$METRIC\" = \"cpu\" ]; then\n            VALS=$(echo \"$JSON\" | \"$JQ_BIN\" -r '.containers[].usage.cpu // empty')\n            if [ -z \"$VALS\" ]; then echo \"0\"; exit 0; fi\n            TOTAL=0\n            for V in $VALS; do\n                if [[ \"$V\" == *n ]]; then NUM=${V%n}; MILLI=$((NUM / 1000000));\n                elif [[ \"$V\" == *m ]]; then MILLI=${V%m};\n                elif [[ \"$V\" == *u ]]; then NUM=${V%u}; MILLI=$((NUM / 1000));\n                else MILLI=$((V * 1000)); fi\n                TOTAL=$((TOTAL + MILLI))\n            done\n            echo \"$TOTAL\"\n        elif [ \"$METRIC\" = \"memory\" ]; then\n            VALS=$(echo \"$JSON\" | \"$JQ_BIN\" -r '.containers[].usage.memory // empty')\n            if [ -z \"$VALS\" ]; then echo \"0\"; exit 0; fi\n            TOTAL=0\n            for V in $VALS; do\n                if [[ \"$V\" == *Ki ]]; then NUM=${V%Ki}; BYTES=$((NUM * 1024));\n                elif [[ \"$V\" == *Mi ]]; then NUM=${V%Mi}; BYTES=$((NUM * 1024 * 1024));\n                elif [[ \"$V\" == *Gi ]]; then NUM=${V%Gi}; BYTES=$((NUM * 1024 * 1024 * 1024));\n                else BYTES=$V; fi\n                TOTAL=$((TOTAL + BYTES))\n            done\n            echo \"$TOTAL\"\n        fi\n    elif [ \"$METRIC\" = \"restarts\" ]; then\n        # Fetch from Core API\n        JSON=$(wget -q --no-check-certificate --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/namespaces/$NAMESPACE/pods/$NAME\")\n        RESTARTS=$(echo \"$JSON\" | \"$JQ_BIN\" '[.status.containerStatuses[]?.restartCount] | add')\n        echo \"${RESTARTS:-0}\"\n    elif [ \"$METRIC\" = \"oom_killed\" ]; then\n        # Check if any container was terminated with reason OOMKilled\n        JSON=$(wget -q --no-check-certificate --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/namespaces/$NAMESPACE/pods/$NAME\")\n        OOM=$(echo \"$JSON\" | \"$JQ_BIN\" '[.status.containerStatuses[]?.lastState.terminated.reason == \"OOMKilled\"] | any')\n        if [ \"$OOM\" = \"true\" ]; then echo 1; else echo 0; fi\n    elif [ \"$METRIC\" = \"phase\" ]; then\n         JSON=$(wget -q --no-check-certificate --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/namespaces/$NAMESPACE/pods/$NAME\")\n         echo \"$JSON\" | \"$JQ_BIN\" -r '.status.phase'\n    else\n        echo \"0\"\n    fi\n\n  k8s_cluster_stats.sh: |\n    #!/bin/bash\n    API_URL=\"https://kubernetes.default.svc\"\n    TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\n    JQ_BIN=\"/tmp/jq\"\n    if [ ! -f \"$JQ_BIN\" ]; then\n        wget -q -O \"$JQ_BIN\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\n        chmod +x \"$JQ_BIN\"\n    fi\n\n    # --- 1. Fetch Nodes for Allocatable Resources \u0026 Conditions ---\n    NODES_JSON=$(wget -q --no-check-certificate --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/nodes\")\n    NODE_COUNT=$(echo \"$NODES_JSON\" | \"$JQ_BIN\" '.items | length')\n    \n    # Calculate Allocatable CPU (m) and Memory (Bytes)\n    # CPU Unit conversion: 1 -\u003e 1000, 100m -\u003e 100\n    ALLOC_CPU=$(echo \"$NODES_JSON\" | \"$JQ_BIN\" '[.items[].status.allocatable.cpu | if test(\"m$\") then sub(\"m\";\"\")|tonumber else tonumber*1000 end] | add')\n    # Memory Unit conversion: Ki-\u003e1024, Mi-\u003e1024^2, Gi-\u003e1024^3\n    ALLOC_MEM=$(echo \"$NODES_JSON\" | \"$JQ_BIN\" '[.items[].status.allocatable.memory | if test(\"Ki$\") then sub(\"Ki\";\"\")|tonumber*1024 else if test(\"Mi$\") then sub(\"Mi\";\"\")|tonumber*1048576 else if test(\"Gi$\") then sub(\"Gi\";\"\")|tonumber*1073741824 else tonumber end end end] | add')\n\n    # --- 2. Fetch Pods for Status Counts \u0026 Requests/Limits ---\n    PODS_JSON=$(wget -q --no-check-certificate --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/pods\")\n    POD_COUNT=$(echo \"$PODS_JSON\" | \"$JQ_BIN\" '.items | length')\n    \n    # Pod Status Counts\n    PODS_RUNNING=$(echo \"$PODS_JSON\" | \"$JQ_BIN\" '[.items[] | select(.status.phase==\"Running\")] | length')\n    PODS_PENDING=$(echo \"$PODS_JSON\" | \"$JQ_BIN\" '[.items[] | select(.status.phase==\"Pending\")] | length')\n    PODS_FAILED=$(echo \"$PODS_JSON\" | \"$JQ_BIN\" '[.items[] | select(.status.phase==\"Failed\")] | length')\n    PODS_SUCCEEDED=$(echo \"$PODS_JSON\" | \"$JQ_BIN\" '[.items[] | select(.status.phase==\"Succeeded\")] | length')\n    \n    # Total Restarts\n    TOTAL_RESTARTS=$(echo \"$PODS_JSON\" | \"$JQ_BIN\" '[.items[].status.containerStatuses[]?.restartCount // 0] | add')\n\n    # Calculate Requests/Limits (Approximate - simplified parsing)\n    # Note: This is complex in pure shell/jq without external tools, doing best effort.\n    # We will sum CPU requests in millicores and Mem requests in Bytes.\n    # Requires filtering containers with resources defined.\n    \n    REQ_CPU=$(echo \"$PODS_JSON\" | \"$JQ_BIN\" '[.items[].spec.containers[].resources.requests.cpu // \"0\"] | map(if test(\"m$\") then sub(\"m\";\"\")|tonumber else if test(\"^[0-9]+$\") then tonumber*1000 else 0 end end) | add')\n    REQ_MEM=$(echo \"$PODS_JSON\" | \"$JQ_BIN\" '[.items[].spec.containers[].resources.requests.memory // \"0\"] | map(if test(\"Ki$\") then sub(\"Ki\";\"\")|tonumber*1024 else if test(\"Mi$\") then sub(\"Mi\";\"\")|tonumber*1048576 else if test(\"Gi$\") then sub(\"Gi\";\"\")|tonumber*1073741824 else if test(\"^[0-9]+$\") then tonumber else 0 end end end end) | add')\n\n    # --- 3. Deployments Stats ---\n    # Need to query deployments separately\n    DEPLOYS_JSON=$(wget -q --no-check-certificate --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/apis/apps/v1/deployments\")\n    DEP_DESIRED=$(echo \"$DEPLOYS_JSON\" | \"$JQ_BIN\" '[.items[].spec.replicas // 0] | add')\n    DEP_AVAILABLE=$(echo \"$DEPLOYS_JSON\" | \"$JQ_BIN\" '[.items[].status.availableReplicas // 0] | add')\n\n    # --- 4. Services Health ---\n    # We check Endpoints to see if services have backing pods\n    ENDPOINTS_JSON=$(wget -q --no-check-certificate --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/endpoints\")\n    SVC_TOTAL=$(echo \"$ENDPOINTS_JSON\" | \"$JQ_BIN\" '.items | length')\n    # Unhealthy = No subsets (no backends)\n    SVC_UNHEALTHY=$(echo \"$ENDPOINTS_JSON\" | \"$JQ_BIN\" '[.items[] | select(.subsets == null or (.subsets | length == 0))] | length')\n\n    # --- 5. Usage Metrics (from previous script logic) ---\n    METRICS=$(wget -q --no-check-certificate --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/apis/metrics.k8s.io/v1beta1/nodes\")\n    METRICS_COUNT=$(echo \"$METRICS\" | \"$JQ_BIN\" '.items | length')\n    \n    if [ \"$METRICS_COUNT\" -gt 0 ]; then\n       # Total Usage\n       USAGE_CPU=$(echo \"$METRICS\" | \"$JQ_BIN\" '[.items[].usage.cpu | sub(\"n\";\"\") | tonumber] | add')\n       USAGE_CPU=$((USAGE_CPU / 1000000)) # nano to milli\n       \n       USAGE_MEM=$(echo \"$METRICS\" | \"$JQ_BIN\" '[.items[].usage.memory | sub(\"Ki\";\"\") | tonumber] | add')\n       USAGE_MEM=$((USAGE_MEM * 1024)) # Ki to Bytes\n       \n       # Averages\n       CPU_AVG=$((USAGE_CPU / METRICS_COUNT))\n       MEM_AVG=$((USAGE_MEM / METRICS_COUNT))\n    else\n       USAGE_CPU=0\n       USAGE_MEM=0\n       CPU_AVG=0\n       MEM_AVG=0\n    fi\n\n    # Construct JSON Output\n    echo \"{\n        \\\"nodes\\\": ${NODE_COUNT:-0},\n        \\\"allocatable_cpu\\\": ${ALLOC_CPU:-0},\n        \\\"allocatable_mem\\\": ${ALLOC_MEM:-0},\n        \\\"usage_cpu\\\": ${USAGE_CPU:-0},\n        \\\"usage_mem\\\": ${USAGE_MEM:-0},\n        \\\"requests_cpu\\\": ${REQ_CPU:-0},\n        \\\"requests_mem\\\": ${REQ_MEM:-0},\n        \\\"pods\\\": ${POD_COUNT:-0},\n        \\\"pods_running\\\": ${PODS_RUNNING:-0},\n        \\\"pods_pending\\\": ${PODS_PENDING:-0},\n        \\\"pods_failed\\\": ${PODS_FAILED:-0},\n        \\\"pods_succeeded\\\": ${PODS_SUCCEEDED:-0},\n        \\\"pods_restarts\\\": ${TOTAL_RESTARTS:-0},\n        \\\"cpu_avg\\\": ${CPU_AVG:-0},\n        \\\"mem_avg\\\": ${MEM_AVG:-0},\n        \\\"deployments_desired\\\": ${DEP_DESIRED:-0},\n        \\\"deployments_available\\\": ${DEP_AVAILABLE:-0},\n        \\\"services_total\\\": ${SVC_TOTAL:-0},\n        \\\"services_unhealthy\\\": ${SVC_UNHEALTHY:-0}\n    }\"\n\n  k8s_deployment_discovery.sh: |\n    #!/bin/bash\n    API_URL=\"https://kubernetes.default.svc\"\n    TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\n    JQ_BIN=\"/tmp/jq\"\n    if [ ! -f \"$JQ_BIN\" ]; then\n        wget -q -O \"$JQ_BIN\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\n        chmod +x \"$JQ_BIN\"\n    fi\n    JSON=$(wget -q --no-check-certificate --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/apis/apps/v1/deployments\")\n    echo \"$JSON\" | \"$JQ_BIN\" -c '{data: [.items[] | {\"{#NAME}\": .metadata.name, \"{#NAMESPACE}\": .metadata.namespace}]}'\n\n  k8s_deployment_metrics.sh: |\n    #!/bin/bash\n    NAMESPACE=\"$1\"\n    NAME=\"$2\"\n    METRIC=\"$3\"\n    API_URL=\"https://kubernetes.default.svc\"\n    TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\n    JQ_BIN=\"/tmp/jq\"\n    if [ ! -f \"$JQ_BIN\" ]; then\n        wget -q -O \"$JQ_BIN\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\n        chmod +x \"$JQ_BIN\"\n    fi\n    JSON=$(wget -q --no-check-certificate --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/apis/apps/v1/namespaces/$NAMESPACE/deployments/$NAME\")\n    \n    if [ \"$METRIC\" = \"replicas\" ]; then\n        echo \"$JSON\" | \"$JQ_BIN\" '.spec.replicas // 0'\n    elif [ \"$METRIC\" = \"available_replicas\" ]; then\n        echo \"$JSON\" | \"$JQ_BIN\" '.status.availableReplicas // 0'\n    elif [ \"$METRIC\" = \"unavailable_replicas\" ]; then\n        echo \"$JSON\" | \"$JQ_BIN\" '.status.unavailableReplicas // 0'\n    else\n        echo \"0\"\n    fi\n\n  k8s_node_metrics.sh: |\n    #!/bin/bash\n    NODE_NAME=\"$1\"\n    METRIC=\"$2\"\n    API_URL=\"https://kubernetes.default.svc\"\n    TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\n    JQ_BIN=\"/tmp/jq\"\n    if [ ! -f \"$JQ_BIN\" ]; then\n        wget -q -O \"$JQ_BIN\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\n        chmod +x \"$JQ_BIN\"\n    fi\n    \n    # Standard metrics from metrics API\n    if [ \"$METRIC\" = \"cpu\" ] || [ \"$METRIC\" = \"memory\" ]; then\n        JSON=$(wget -q --no-check-certificate --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/apis/metrics.k8s.io/v1beta1/nodes/$NODE_NAME\")\n        if [ \"$METRIC\" = \"cpu\" ]; then\n            V=$(echo \"$JSON\" | \"$JQ_BIN\" -r '.usage.cpu')\n            if [[ \"$V\" == *n ]]; then NUM=${V%n}; MILLI=$((NUM / 1000000));\n            elif [[ \"$V\" == *m ]]; then MILLI=${V%m};\n            elif [[ \"$V\" == *u ]]; then NUM=${V%u}; MILLI=$((NUM / 1000));\n            else MILLI=$((V * 1000)); fi\n            echo \"$MILLI\"\n        elif [ \"$METRIC\" = \"memory\" ]; then\n            V=$(echo \"$JSON\" | \"$JQ_BIN\" -r '.usage.memory')\n            if [[ \"$V\" == *Ki ]]; then NUM=${V%Ki}; BYTES=$((NUM * 1024));\n            elif [[ \"$V\" == *Mi ]]; then NUM=${V%Mi}; BYTES=$((NUM * 1024 * 1024));\n            elif [[ \"$V\" == *Gi ]]; then NUM=${V%Gi}; BYTES=$((NUM * 1024 * 1024 * 1024));\n            else BYTES=$V; fi\n            echo \"$BYTES\"\n        fi\n    # Node Conditions from Core API\n    else\n        JSON=$(wget -q --no-check-certificate --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/nodes/$NODE_NAME\")\n        if [ \"$METRIC\" = \"disk_pressure\" ]; then\n            STATUS=$(echo \"$JSON\" | \"$JQ_BIN\" -r '.status.conditions[] | select(.type==\"DiskPressure\") | .status')\n            if [ \"$STATUS\" = \"True\" ]; then echo 1; else echo 0; fi\n        elif [ \"$METRIC\" = \"memory_pressure\" ]; then\n            STATUS=$(echo \"$JSON\" | \"$JQ_BIN\" -r '.status.conditions[] | select(.type==\"MemoryPressure\") | .status')\n            if [ \"$STATUS\" = \"True\" ]; then echo 1; else echo 0; fi\n        elif [ \"$METRIC\" = \"ready\" ]; then\n            STATUS=$(echo \"$JSON\" | \"$JQ_BIN\" -r '.status.conditions[] | select(.type==\"Ready\") | .status')\n            if [ \"$STATUS\" = \"True\" ]; then echo 1; else echo 0; fi\n        elif [ \"$METRIC\" = \"network_errors\" ]; then\n            # Fetch from Kubelet Summary API via Proxy\n            JSON=$(wget -q --no-check-certificate --header=\"Authorization: Bearer $TOKEN\" -O - \"$API_URL/api/v1/nodes/$NODE_NAME/proxy/stats/summary\")\n            # Sum rxErrors and txErrors from all interfaces\n            RX=$(echo \"$JSON\" | \"$JQ_BIN\" '[.node.network.interfaces[]?.rxErrors // 0] | add')\n            TX=$(echo \"$JSON\" | \"$JQ_BIN\" '[.node.network.interfaces[]?.txErrors // 0] | add')\n            echo $((RX + TX))\n        else\n            echo \"0\"\n        fi\n    fi\n"
            },
            "kind": "ConfigMap",
            "metadata": {
                "annotations": {
                    "kubectl.kubernetes.io/last-applied-configuration": "{\"apiVersion\":\"v1\",\"data\":{\"zabbix-scripts.yaml\":\"apiVersion: v1\\nkind: ConfigMap\\nmetadata:\\n  name: zabbix-external-scripts\\n  namespace: zabbix\\ndata:\\n  github_connector.sh: |\\n    #!/bin/bash\\n    # [DEPRECATED] Este script ya no es necesario con el template nativo \\\"Template GitHub Repository Metrics\\\" (HTTP_AGENT).\\n    # La configuración ahora se realiza via Macros en la interfaz web de Zabbix.\\n    #\\n    # Script para conectar Zabbix con GitHub (Soporta Token)\\n    # Uso: github_connector.sh \\u003cOWNER\\u003e \\u003cREPO\\u003e \\u003cTYPE\\u003e \\u003cTOKEN\\u003e \\u003cAPI_URL\\u003e\\n    \\n    OWNER=\\\"${1:-Ka0s-Klaus}\\\"\\n    REPO=\\\"${2:-ka0s}\\\"\\n    TYPE=\\\"${3:-metrics}\\\"\\n    TOKEN=\\\"$4\\\"\\n    API_URL=\\\"${5:-https://api.github.com}\\\"\\n    \\n    FULL_REPO=\\\"$OWNER/$REPO\\\"\\n    JQ_BIN=\\\"/tmp/jq\\\"\\n    \\n    # Auto-descarga de jq\\n    if [ ! -f \\\"$JQ_BIN\\\" ]; then\\n        wget -q -O \\\"$JQ_BIN\\\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\\n        chmod +x \\\"$JQ_BIN\\\"\\n    fi\\n\\n    # Función wrapper para wget con autenticación opcional\\n    fetch_url() {\\n        local url=\\\"$1\\\"\\n        if [ -n \\\"$TOKEN\\\" ] \\u0026\\u0026 [ \\\"$TOKEN\\\" != \\\"\\\" ]; then\\n            wget -q --no-check-certificate --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$url\\\"\\n        else\\n            wget -q --no-check-certificate -O - \\\"$url\\\"\\n        fi\\n    }\\n\\n    if [ \\\"$TYPE\\\" = \\\"metrics\\\" ]; then\\n        # 1. Info General\\n        REPO_JSON=$(fetch_url \\\"$API_URL/repos/$FULL_REPO\\\")\\n        \\n        # 2. Pull Requests (Search API)\\n        PR_JSON=$(fetch_url \\\"$API_URL/search/issues?q=repo:$FULL_REPO+type:pr+state:open\\\")\\n        \\n        if [ -x \\\"$JQ_BIN\\\" ]; then\\n            echo \\\"$REPO_JSON\\\" | \\\"$JQ_BIN\\\" --argjson prs \\\"$PR_JSON\\\" '{\\n                stars: .stargazers_count,\\n                forks: .forks_count,\\n                open_issues: .open_issues_count,\\n                watchers: .subscribers_count,\\n                size_kb: .size,\\n                created_at: .created_at,\\n                updated_at: .updated_at,\\n                pushed_at: .pushed_at,\\n                language: .language,\\n                open_prs: $prs.total_count\\n            }'\\n        else\\n            echo \\\"Error: jq required\\\"\\n        fi\\n        \\n    elif [ \\\"$TYPE\\\" = \\\"info\\\" ]; then\\n        # Legacy info\\n        JSON=$(fetch_url \\\"$API_URL/repos/$FULL_REPO\\\")\\n        STARS=$(echo \\\"$JSON\\\" | grep -o '\\\"stargazers_count\\\": [0-9]*' | head -1 | awk '{print $2}')\\n        echo \\\"Stars: $STARS\\\"\\n        \\n    else\\n        # Actions\\n        JSON=$(fetch_url \\\"$API_URL/repos/$FULL_REPO/actions/runs?per_page=10\\\")\\n        \\n        if [ -x \\\"$JQ_BIN\\\" ]; then\\n             echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -r '.workflow_runs[] | \\\"Workflow: \\\\(.name) (#\\\\(.run_number)) | Status: \\\\(.conclusion) | Branch: \\\\(.head_branch) | Author: \\\\(.actor.login) | Event: \\\\(.event)\\\"'\\n        else\\n             echo \\\"Error: jq required\\\"\\n        fi\\n    fi\\n\\n  k8s_discovery.sh: |\\n    #!/bin/bash\\n    API_URL=\\\"https://kubernetes.default.svc\\\"\\n    TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\\n    JQ_BIN=\\\"/tmp/jq\\\"\\n\\n    if [ ! -f \\\"$JQ_BIN\\\" ]; then\\n        wget -q -O \\\"$JQ_BIN\\\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\\n        chmod +x \\\"$JQ_BIN\\\"\\n    fi\\n\\n    # Discovery\\n    JSON=$(wget -q --no-check-certificate --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/services\\\")\\n\\n    echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -c '{data: [.items[] | {\\\"{#SERVICE_NAME}\\\": .metadata.name, \\\"{#SERVICE_NAMESPACE}\\\": .metadata.namespace, \\\"{#SERVICE_TYPE}\\\": .spec.type}]}'\\n\\n  k8s_endpoints.sh: |\\n    #!/bin/bash\\n    NAMESPACE=\\\"$1\\\"\\n    NAME=\\\"$2\\\"\\n    API_URL=\\\"https://kubernetes.default.svc\\\"\\n    TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\\n    JQ_BIN=\\\"/tmp/jq\\\"\\n\\n    if [ ! -f \\\"$JQ_BIN\\\" ]; then\\n        wget -q -O \\\"$JQ_BIN\\\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\\n        chmod +x \\\"$JQ_BIN\\\"\\n    fi\\n\\n    JSON=$(wget -q --no-check-certificate --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/namespaces/$NAMESPACE/endpoints/$NAME\\\")\\n\\n    # Count subsets[].addresses[].ip\\n    COUNT=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" '[.subsets[]?.addresses[]?] | length')\\n\\n    if [ -z \\\"$COUNT\\\" ]; then echo 0; else echo \\\"$COUNT\\\"; fi\\n\\n  k8s_pod_discovery.sh: |\\n    #!/bin/bash\\n    API_URL=\\\"https://kubernetes.default.svc\\\"\\n    TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\\n    JQ_BIN=\\\"/tmp/jq\\\"\\n    if [ ! -f \\\"$JQ_BIN\\\" ]; then\\n        wget -q -O \\\"$JQ_BIN\\\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\\n        chmod +x \\\"$JQ_BIN\\\"\\n    fi\\n    JSON=$(wget -q --no-check-certificate --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/pods\\\")\\n    # Discover ALL pods, not just Running, to detect Pending/Failed/Restarts\\n    echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -c '{data: [.items[] | {\\\"{#POD_NAME}\\\": .metadata.name, \\\"{#POD_NAMESPACE}\\\": .metadata.namespace, \\\"{#POD_IP}\\\": .status.podIP}]}'\\n\\n  k8s_pod_metrics.sh: |\\n    #!/bin/bash\\n    NAMESPACE=\\\"$1\\\"\\n    NAME=\\\"$2\\\"\\n    METRIC=\\\"$3\\\"\\n    API_URL=\\\"https://kubernetes.default.svc\\\"\\n    TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\\n    JQ_BIN=\\\"/tmp/jq\\\"\\n    if [ ! -f \\\"$JQ_BIN\\\" ]; then\\n        wget -q -O \\\"$JQ_BIN\\\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\\n        chmod +x \\\"$JQ_BIN\\\"\\n    fi\\n    \\n    if [ \\\"$METRIC\\\" = \\\"cpu\\\" ] || [ \\\"$METRIC\\\" = \\\"memory\\\" ]; then\\n        # Fetch from Metrics API\\n        JSON=$(wget -q --no-check-certificate --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/apis/metrics.k8s.io/v1beta1/namespaces/$NAMESPACE/pods/$NAME\\\")\\n        \\n        if [ \\\"$METRIC\\\" = \\\"cpu\\\" ]; then\\n            VALS=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -r '.containers[].usage.cpu // empty')\\n            if [ -z \\\"$VALS\\\" ]; then echo \\\"0\\\"; exit 0; fi\\n            TOTAL=0\\n            for V in $VALS; do\\n                if [[ \\\"$V\\\" == *n ]]; then NUM=${V%n}; MILLI=$((NUM / 1000000));\\n                elif [[ \\\"$V\\\" == *m ]]; then MILLI=${V%m};\\n                elif [[ \\\"$V\\\" == *u ]]; then NUM=${V%u}; MILLI=$((NUM / 1000));\\n                else MILLI=$((V * 1000)); fi\\n                TOTAL=$((TOTAL + MILLI))\\n            done\\n            echo \\\"$TOTAL\\\"\\n        elif [ \\\"$METRIC\\\" = \\\"memory\\\" ]; then\\n            VALS=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -r '.containers[].usage.memory // empty')\\n            if [ -z \\\"$VALS\\\" ]; then echo \\\"0\\\"; exit 0; fi\\n            TOTAL=0\\n            for V in $VALS; do\\n                if [[ \\\"$V\\\" == *Ki ]]; then NUM=${V%Ki}; BYTES=$((NUM * 1024));\\n                elif [[ \\\"$V\\\" == *Mi ]]; then NUM=${V%Mi}; BYTES=$((NUM * 1024 * 1024));\\n                elif [[ \\\"$V\\\" == *Gi ]]; then NUM=${V%Gi}; BYTES=$((NUM * 1024 * 1024 * 1024));\\n                else BYTES=$V; fi\\n                TOTAL=$((TOTAL + BYTES))\\n            done\\n            echo \\\"$TOTAL\\\"\\n        fi\\n    elif [ \\\"$METRIC\\\" = \\\"restarts\\\" ]; then\\n        # Fetch from Core API\\n        JSON=$(wget -q --no-check-certificate --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/namespaces/$NAMESPACE/pods/$NAME\\\")\\n        RESTARTS=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" '[.status.containerStatuses[]?.restartCount] | add')\\n        echo \\\"${RESTARTS:-0}\\\"\\n    elif [ \\\"$METRIC\\\" = \\\"oom_killed\\\" ]; then\\n        # Check if any container was terminated with reason OOMKilled\\n        JSON=$(wget -q --no-check-certificate --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/namespaces/$NAMESPACE/pods/$NAME\\\")\\n        OOM=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" '[.status.containerStatuses[]?.lastState.terminated.reason == \\\"OOMKilled\\\"] | any')\\n        if [ \\\"$OOM\\\" = \\\"true\\\" ]; then echo 1; else echo 0; fi\\n    elif [ \\\"$METRIC\\\" = \\\"phase\\\" ]; then\\n         JSON=$(wget -q --no-check-certificate --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/namespaces/$NAMESPACE/pods/$NAME\\\")\\n         echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -r '.status.phase'\\n    else\\n        echo \\\"0\\\"\\n    fi\\n\\n  k8s_cluster_stats.sh: |\\n    #!/bin/bash\\n    API_URL=\\\"https://kubernetes.default.svc\\\"\\n    TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\\n    JQ_BIN=\\\"/tmp/jq\\\"\\n    if [ ! -f \\\"$JQ_BIN\\\" ]; then\\n        wget -q -O \\\"$JQ_BIN\\\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\\n        chmod +x \\\"$JQ_BIN\\\"\\n    fi\\n\\n    # --- 1. Fetch Nodes for Allocatable Resources \\u0026 Conditions ---\\n    NODES_JSON=$(wget -q --no-check-certificate --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/nodes\\\")\\n    NODE_COUNT=$(echo \\\"$NODES_JSON\\\" | \\\"$JQ_BIN\\\" '.items | length')\\n    \\n    # Calculate Allocatable CPU (m) and Memory (Bytes)\\n    # CPU Unit conversion: 1 -\\u003e 1000, 100m -\\u003e 100\\n    ALLOC_CPU=$(echo \\\"$NODES_JSON\\\" | \\\"$JQ_BIN\\\" '[.items[].status.allocatable.cpu | if test(\\\"m$\\\") then sub(\\\"m\\\";\\\"\\\")|tonumber else tonumber*1000 end] | add')\\n    # Memory Unit conversion: Ki-\\u003e1024, Mi-\\u003e1024^2, Gi-\\u003e1024^3\\n    ALLOC_MEM=$(echo \\\"$NODES_JSON\\\" | \\\"$JQ_BIN\\\" '[.items[].status.allocatable.memory | if test(\\\"Ki$\\\") then sub(\\\"Ki\\\";\\\"\\\")|tonumber*1024 else if test(\\\"Mi$\\\") then sub(\\\"Mi\\\";\\\"\\\")|tonumber*1048576 else if test(\\\"Gi$\\\") then sub(\\\"Gi\\\";\\\"\\\")|tonumber*1073741824 else tonumber end end end] | add')\\n\\n    # --- 2. Fetch Pods for Status Counts \\u0026 Requests/Limits ---\\n    PODS_JSON=$(wget -q --no-check-certificate --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/pods\\\")\\n    POD_COUNT=$(echo \\\"$PODS_JSON\\\" | \\\"$JQ_BIN\\\" '.items | length')\\n    \\n    # Pod Status Counts\\n    PODS_RUNNING=$(echo \\\"$PODS_JSON\\\" | \\\"$JQ_BIN\\\" '[.items[] | select(.status.phase==\\\"Running\\\")] | length')\\n    PODS_PENDING=$(echo \\\"$PODS_JSON\\\" | \\\"$JQ_BIN\\\" '[.items[] | select(.status.phase==\\\"Pending\\\")] | length')\\n    PODS_FAILED=$(echo \\\"$PODS_JSON\\\" | \\\"$JQ_BIN\\\" '[.items[] | select(.status.phase==\\\"Failed\\\")] | length')\\n    PODS_SUCCEEDED=$(echo \\\"$PODS_JSON\\\" | \\\"$JQ_BIN\\\" '[.items[] | select(.status.phase==\\\"Succeeded\\\")] | length')\\n    \\n    # Total Restarts\\n    TOTAL_RESTARTS=$(echo \\\"$PODS_JSON\\\" | \\\"$JQ_BIN\\\" '[.items[].status.containerStatuses[]?.restartCount // 0] | add')\\n\\n    # Calculate Requests/Limits (Approximate - simplified parsing)\\n    # Note: This is complex in pure shell/jq without external tools, doing best effort.\\n    # We will sum CPU requests in millicores and Mem requests in Bytes.\\n    # Requires filtering containers with resources defined.\\n    \\n    REQ_CPU=$(echo \\\"$PODS_JSON\\\" | \\\"$JQ_BIN\\\" '[.items[].spec.containers[].resources.requests.cpu // \\\"0\\\"] | map(if test(\\\"m$\\\") then sub(\\\"m\\\";\\\"\\\")|tonumber else if test(\\\"^[0-9]+$\\\") then tonumber*1000 else 0 end end) | add')\\n    REQ_MEM=$(echo \\\"$PODS_JSON\\\" | \\\"$JQ_BIN\\\" '[.items[].spec.containers[].resources.requests.memory // \\\"0\\\"] | map(if test(\\\"Ki$\\\") then sub(\\\"Ki\\\";\\\"\\\")|tonumber*1024 else if test(\\\"Mi$\\\") then sub(\\\"Mi\\\";\\\"\\\")|tonumber*1048576 else if test(\\\"Gi$\\\") then sub(\\\"Gi\\\";\\\"\\\")|tonumber*1073741824 else if test(\\\"^[0-9]+$\\\") then tonumber else 0 end end end end) | add')\\n\\n    # --- 3. Deployments Stats ---\\n    # Need to query deployments separately\\n    DEPLOYS_JSON=$(wget -q --no-check-certificate --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/apis/apps/v1/deployments\\\")\\n    DEP_DESIRED=$(echo \\\"$DEPLOYS_JSON\\\" | \\\"$JQ_BIN\\\" '[.items[].spec.replicas // 0] | add')\\n    DEP_AVAILABLE=$(echo \\\"$DEPLOYS_JSON\\\" | \\\"$JQ_BIN\\\" '[.items[].status.availableReplicas // 0] | add')\\n\\n    # --- 4. Services Health ---\\n    # We check Endpoints to see if services have backing pods\\n    ENDPOINTS_JSON=$(wget -q --no-check-certificate --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/endpoints\\\")\\n    SVC_TOTAL=$(echo \\\"$ENDPOINTS_JSON\\\" | \\\"$JQ_BIN\\\" '.items | length')\\n    # Unhealthy = No subsets (no backends)\\n    SVC_UNHEALTHY=$(echo \\\"$ENDPOINTS_JSON\\\" | \\\"$JQ_BIN\\\" '[.items[] | select(.subsets == null or (.subsets | length == 0))] | length')\\n\\n    # --- 5. Usage Metrics (from previous script logic) ---\\n    METRICS=$(wget -q --no-check-certificate --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/apis/metrics.k8s.io/v1beta1/nodes\\\")\\n    METRICS_COUNT=$(echo \\\"$METRICS\\\" | \\\"$JQ_BIN\\\" '.items | length')\\n    \\n    if [ \\\"$METRICS_COUNT\\\" -gt 0 ]; then\\n       # Total Usage\\n       USAGE_CPU=$(echo \\\"$METRICS\\\" | \\\"$JQ_BIN\\\" '[.items[].usage.cpu | sub(\\\"n\\\";\\\"\\\") | tonumber] | add')\\n       USAGE_CPU=$((USAGE_CPU / 1000000)) # nano to milli\\n       \\n       USAGE_MEM=$(echo \\\"$METRICS\\\" | \\\"$JQ_BIN\\\" '[.items[].usage.memory | sub(\\\"Ki\\\";\\\"\\\") | tonumber] | add')\\n       USAGE_MEM=$((USAGE_MEM * 1024)) # Ki to Bytes\\n       \\n       # Averages\\n       CPU_AVG=$((USAGE_CPU / METRICS_COUNT))\\n       MEM_AVG=$((USAGE_MEM / METRICS_COUNT))\\n    else\\n       USAGE_CPU=0\\n       USAGE_MEM=0\\n       CPU_AVG=0\\n       MEM_AVG=0\\n    fi\\n\\n    # Construct JSON Output\\n    echo \\\"{\\n        \\\\\\\"nodes\\\\\\\": ${NODE_COUNT:-0},\\n        \\\\\\\"allocatable_cpu\\\\\\\": ${ALLOC_CPU:-0},\\n        \\\\\\\"allocatable_mem\\\\\\\": ${ALLOC_MEM:-0},\\n        \\\\\\\"usage_cpu\\\\\\\": ${USAGE_CPU:-0},\\n        \\\\\\\"usage_mem\\\\\\\": ${USAGE_MEM:-0},\\n        \\\\\\\"requests_cpu\\\\\\\": ${REQ_CPU:-0},\\n        \\\\\\\"requests_mem\\\\\\\": ${REQ_MEM:-0},\\n        \\\\\\\"pods\\\\\\\": ${POD_COUNT:-0},\\n        \\\\\\\"pods_running\\\\\\\": ${PODS_RUNNING:-0},\\n        \\\\\\\"pods_pending\\\\\\\": ${PODS_PENDING:-0},\\n        \\\\\\\"pods_failed\\\\\\\": ${PODS_FAILED:-0},\\n        \\\\\\\"pods_succeeded\\\\\\\": ${PODS_SUCCEEDED:-0},\\n        \\\\\\\"pods_restarts\\\\\\\": ${TOTAL_RESTARTS:-0},\\n        \\\\\\\"cpu_avg\\\\\\\": ${CPU_AVG:-0},\\n        \\\\\\\"mem_avg\\\\\\\": ${MEM_AVG:-0},\\n        \\\\\\\"deployments_desired\\\\\\\": ${DEP_DESIRED:-0},\\n        \\\\\\\"deployments_available\\\\\\\": ${DEP_AVAILABLE:-0},\\n        \\\\\\\"services_total\\\\\\\": ${SVC_TOTAL:-0},\\n        \\\\\\\"services_unhealthy\\\\\\\": ${SVC_UNHEALTHY:-0}\\n    }\\\"\\n\\n  k8s_deployment_discovery.sh: |\\n    #!/bin/bash\\n    API_URL=\\\"https://kubernetes.default.svc\\\"\\n    TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\\n    JQ_BIN=\\\"/tmp/jq\\\"\\n    if [ ! -f \\\"$JQ_BIN\\\" ]; then\\n        wget -q -O \\\"$JQ_BIN\\\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\\n        chmod +x \\\"$JQ_BIN\\\"\\n    fi\\n    JSON=$(wget -q --no-check-certificate --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/apis/apps/v1/deployments\\\")\\n    echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -c '{data: [.items[] | {\\\"{#NAME}\\\": .metadata.name, \\\"{#NAMESPACE}\\\": .metadata.namespace}]}'\\n\\n  k8s_deployment_metrics.sh: |\\n    #!/bin/bash\\n    NAMESPACE=\\\"$1\\\"\\n    NAME=\\\"$2\\\"\\n    METRIC=\\\"$3\\\"\\n    API_URL=\\\"https://kubernetes.default.svc\\\"\\n    TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\\n    JQ_BIN=\\\"/tmp/jq\\\"\\n    if [ ! -f \\\"$JQ_BIN\\\" ]; then\\n        wget -q -O \\\"$JQ_BIN\\\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\\n        chmod +x \\\"$JQ_BIN\\\"\\n    fi\\n    JSON=$(wget -q --no-check-certificate --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/apis/apps/v1/namespaces/$NAMESPACE/deployments/$NAME\\\")\\n    \\n    if [ \\\"$METRIC\\\" = \\\"replicas\\\" ]; then\\n        echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" '.spec.replicas // 0'\\n    elif [ \\\"$METRIC\\\" = \\\"available_replicas\\\" ]; then\\n        echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" '.status.availableReplicas // 0'\\n    elif [ \\\"$METRIC\\\" = \\\"unavailable_replicas\\\" ]; then\\n        echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" '.status.unavailableReplicas // 0'\\n    else\\n        echo \\\"0\\\"\\n    fi\\n\\n  k8s_node_metrics.sh: |\\n    #!/bin/bash\\n    NODE_NAME=\\\"$1\\\"\\n    METRIC=\\\"$2\\\"\\n    API_URL=\\\"https://kubernetes.default.svc\\\"\\n    TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\\n    JQ_BIN=\\\"/tmp/jq\\\"\\n    if [ ! -f \\\"$JQ_BIN\\\" ]; then\\n        wget -q -O \\\"$JQ_BIN\\\" https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64\\n        chmod +x \\\"$JQ_BIN\\\"\\n    fi\\n    \\n    # Standard metrics from metrics API\\n    if [ \\\"$METRIC\\\" = \\\"cpu\\\" ] || [ \\\"$METRIC\\\" = \\\"memory\\\" ]; then\\n        JSON=$(wget -q --no-check-certificate --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/apis/metrics.k8s.io/v1beta1/nodes/$NODE_NAME\\\")\\n        if [ \\\"$METRIC\\\" = \\\"cpu\\\" ]; then\\n            V=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -r '.usage.cpu')\\n            if [[ \\\"$V\\\" == *n ]]; then NUM=${V%n}; MILLI=$((NUM / 1000000));\\n            elif [[ \\\"$V\\\" == *m ]]; then MILLI=${V%m};\\n            elif [[ \\\"$V\\\" == *u ]]; then NUM=${V%u}; MILLI=$((NUM / 1000));\\n            else MILLI=$((V * 1000)); fi\\n            echo \\\"$MILLI\\\"\\n        elif [ \\\"$METRIC\\\" = \\\"memory\\\" ]; then\\n            V=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -r '.usage.memory')\\n            if [[ \\\"$V\\\" == *Ki ]]; then NUM=${V%Ki}; BYTES=$((NUM * 1024));\\n            elif [[ \\\"$V\\\" == *Mi ]]; then NUM=${V%Mi}; BYTES=$((NUM * 1024 * 1024));\\n            elif [[ \\\"$V\\\" == *Gi ]]; then NUM=${V%Gi}; BYTES=$((NUM * 1024 * 1024 * 1024));\\n            else BYTES=$V; fi\\n            echo \\\"$BYTES\\\"\\n        fi\\n    # Node Conditions from Core API\\n    else\\n        JSON=$(wget -q --no-check-certificate --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/nodes/$NODE_NAME\\\")\\n        if [ \\\"$METRIC\\\" = \\\"disk_pressure\\\" ]; then\\n            STATUS=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -r '.status.conditions[] | select(.type==\\\"DiskPressure\\\") | .status')\\n            if [ \\\"$STATUS\\\" = \\\"True\\\" ]; then echo 1; else echo 0; fi\\n        elif [ \\\"$METRIC\\\" = \\\"memory_pressure\\\" ]; then\\n            STATUS=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -r '.status.conditions[] | select(.type==\\\"MemoryPressure\\\") | .status')\\n            if [ \\\"$STATUS\\\" = \\\"True\\\" ]; then echo 1; else echo 0; fi\\n        elif [ \\\"$METRIC\\\" = \\\"ready\\\" ]; then\\n            STATUS=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" -r '.status.conditions[] | select(.type==\\\"Ready\\\") | .status')\\n            if [ \\\"$STATUS\\\" = \\\"True\\\" ]; then echo 1; else echo 0; fi\\n        elif [ \\\"$METRIC\\\" = \\\"network_errors\\\" ]; then\\n            # Fetch from Kubelet Summary API via Proxy\\n            JSON=$(wget -q --no-check-certificate --header=\\\"Authorization: Bearer $TOKEN\\\" -O - \\\"$API_URL/api/v1/nodes/$NODE_NAME/proxy/stats/summary\\\")\\n            # Sum rxErrors and txErrors from all interfaces\\n            RX=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" '[.node.network.interfaces[]?.rxErrors // 0] | add')\\n            TX=$(echo \\\"$JSON\\\" | \\\"$JQ_BIN\\\" '[.node.network.interfaces[]?.txErrors // 0] | add')\\n            echo $((RX + TX))\\n        else\\n            echo \\\"0\\\"\\n        fi\\n    fi\\n\"},\"kind\":\"ConfigMap\",\"metadata\":{\"annotations\":{},\"creationTimestamp\":null,\"name\":\"zabbix-scripts\",\"namespace\":\"zabbix\"}}\n"
                },
                "creationTimestamp": "2026-01-21T10:49:12Z",
                "name": "zabbix-scripts",
                "namespace": "zabbix",
                "resourceVersion": "6066497",
                "uid": "654224bc-5e0b-46d4-8948-8fd88c58489a"
            }
        }
    ],
    "kind": "List",
    "metadata": {
        "resourceVersion": ""
    }
}
